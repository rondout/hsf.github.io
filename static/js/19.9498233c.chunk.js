(this["webpackJsonpui-ngx"]=this["webpackJsonpui-ngx"]||[]).push([[19],{671:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return E}));var c,i=n(42),a=n(83),o=n(134),r=n(354),l=n(674),s=n.n(l),u=n(673),d=n.n(u),b=n(43),j=n(36),p=n(47),f=n(173),O=n(155),m=n(37),x=n(672),v=n(106),h=n(251),g=n(104),C=n(0),S=n(1);!function(e){e.BY_TITLE="name",e.BY_CREATED_TIME="createdTime"}(c||(c={}));var I=[new j.e(c.BY_TITLE,"regTemp.sortBy.name"),new j.e(c.BY_CREATED_TIME,"regTemp.sortBy.createdTime")];function E(e){var t=e.sortProp,n=e.onSortChange,c=e.textSearch,l=e.onSearchChange,u=e.deleteDisabled,j=e.deleteTitle,E=e.addTitle,P=e.selectTitle,T=e.showSelectBtn,N=void 0!==T&&T,k=e.selectMode,w=void 0!==k&&k,A=e.authControl,L=void 0===A?"GENERAL":A,y=e.menus||I,R=Object(g.b)(),D=Object(g.a)(),G="GENERAL"===L?D:!R,_=Object(b.c)(p.a),F={add:!N||!w,delete:(!N||w)&&e.onDelete,select:N&&!w,selectAll:N&&w&&e.viewMode===x.a.CARD,cancel:N&&w};return Object(S.jsxs)(i.a,{sx:{mb:2,display:"flex",justifyContent:"space-between",height:36},children:[w&&Object(S.jsxs)(i.a,{className:"flex-start",children:[Object(S.jsx)(a.a,{fontSize:16,color:h.c,children:e.selectedCount}),Object(S.jsx)(a.a,{sx:{ml:1},children:Object(m.b)("common.selected")})]}),!w&&Object(S.jsxs)(i.a,{className:"flex-start",children:[void 0!==e.viewMode&&Object(S.jsx)(x.b,{items:x.c,mode:e.viewMode,onChange:e.onViewModeChange}),_?null:Object(S.jsx)(O.a,{title:"regTemp.sortBy."+t,selected:t,menus:y,onMenuClick:n}),Object(S.jsx)(f.a,{sx:{ml:_?0:2,bgcolor:"#fff"},value:c,onChange:l})]}),G&&Object(S.jsx)(C.Fragment,{children:_?Object(S.jsxs)(i.a,{children:[Object(S.jsx)(r.a,{onClick:e.onAdd,size:"medium",edge:"start",color:"primary","aria-label":"open drawer",sx:{mr:1},children:Object(S.jsx)(d.a,{})}),Object(S.jsx)(r.a,{onClick:e.onDelete,disabled:u,size:"medium",edge:"start",color:"error","aria-label":"open drawer",children:Object(S.jsx)(s.a,{})})]}):Object(S.jsxs)(i.a,{children:[F.add&&Object(S.jsx)(o.a,{onClick:e.onAdd,variant:"contained",children:Object(m.b)(E)}),F.cancel&&Object(S.jsx)(o.a,{onClick:function(){e.selectAll(!1),e.setSelectMode(!1)},variant:"outlined",children:Object(m.b)("common.cancel")}),F.selectAll&&Object(S.jsx)(v.a,{sx:{ml:2},onClick:function(){e.selectAll&&e.selectAll(!0)},children:Object(m.b)("common.selectAll")}),F.select&&Object(S.jsx)(v.a,{sx:{ml:2},onClick:function(){var t;void 0!==t?e.setSelectMode(t):e.setSelectMode(!w)},children:Object(m.b)(P)}),F.delete&&Object(S.jsx)(o.a,{onClick:e.onDelete,disabled:u,sx:{ml:2},variant:void 0!==e.viewMode?"contained":"outlined",children:Object(m.b)(j)})]})})]})}},672:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return p})),n.d(t,"b",(function(){return f}));var c,i=n(5),a=n(7),o=n(134),r=n(64),l=n(689),s=n(995),u=n(171),d=n(51),b=n(1),j=Object(a.a)(o.a)((function(e){var t=e.theme;return{height:36,borderColor:t.palette.action.disabled,"&:hover":{borderColor:t.palette.action.disabled},"&.checked":{backgroundColor:Object(r.a)(t.palette.primary.main,.32)},"&.checked:hover":{backgroundColor:Object(r.a)(t.palette.primary.main,.32)}}}));!function(e){e[e.LIST=0]="LIST",e[e.CARD=1]="CARD"}(c||(c={}));var p=[{icon:"ic_viewmodule",value:c.CARD,label:"common.cardView"},{icon:"ic_viewheadline",value:c.LIST,label:"common.listView"}];function f(e){var t=e.mode,n=e.onChange,c=e.items,a=void 0===c?[]:c,o=e.sx,r=void 0===o?{}:o,p=Object(u.a)().t;return Object(b.jsx)(l.a,{sx:Object(i.a)({mr:2},r),children:a.map((function(e){return Object(b.jsx)(s.a,{title:p(e.label),children:Object(b.jsx)(j,{size:"small",onClick:function(){var c;(c=e.value)!==t&&n(c)},className:t===e.value?"checked":"",sx:{px:1},children:Object(b.jsx)(d.a,{color:"rgba(0, 0, 0, 0.54)",mr:0,icon:e.icon})})},e.label)}))})}},678:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"i",(function(){return r})),n.d(t,"g",(function(){return l})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return b}));var c=n(29),i=function(e){return{type:c.d.INIT_CONFIG_DETAIL,data:e}},a=function(){return{type:c.d.RESET_CONFIG}},o=function(e){return{type:c.d.SET_BASIC_CONFIG,data:e}},r=function(e){return{type:c.d.SET_SETTINGS_CONFIG,data:e}},l=function(e){return{type:c.d.SET_KIOSK_INFO,data:e}},s=function(e){return{type:c.d.SET_DEVICE_CONFIG,data:e}},u=function(e){return{type:c.d.SET_PART_DEVICE_CONFIG,data:e}},d=function(e){return{type:c.d.SET_DEVICE_GROUP,data:e}},b=function(e){return{type:c.d.SET_DEVICE_POOL,data:e}}},680:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return b}));var c=n(84),i=function(e){return e.regTemp.regTempDetail},a=function(e){var t=e.regTemp.regTempDetail;return{name:t.name,description:t.description}},o=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.setting},r=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.kiosk},l=function(e){var t,n=null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.config;return n.wifiForProvision||(n.wifiForProvision=c.w),n},s=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.deviceGroup},u=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.deviceSnPool},d=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.setting.adb},b=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.setting.bluetooth}},682:function(e,t,n){"use strict";var c=n(7),i=n(656),a=n(64),o=Object(c.a)(i.a)((function(e){var t=e.theme;return{backgroundColor:Object(a.a)(t.palette.primary.main,.08),color:t.palette.primary.main,fontSize:14,paddingRight:6}}));t.a=o},684:function(e,t,n){"use strict";var c=n(7),i=n(740),a=Object(c.a)(i.a)((function(){return{cursor:"pointer"}}));t.a=a},691:function(e,t,n){"use strict";var c=n(13),i=n(14),a=n(18),o=n(30),r=n(31),l=n(17),s=n(12),u=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(){var e,c,o,r,u;Object(i.a)(this,n);for(var d=arguments.length,b=new Array(d),j=0;j<d;j++)b[j]=arguments[j];return(u=t.call.apply(t,[this].concat(b))).getAppList=function(t){return Object(l.a)((e=Object(a.a)(u),Object(s.a)(n.prototype)),"get",e).call(e,"/api/apps",{params:t,timeout:12e4})},u.deleteByIdentifier=function(e){return Object(l.a)((c=Object(a.a)(u),Object(s.a)(n.prototype)),"delete",c).call(c,"/api/deleteByIdentifier?identifier="+e)},u.deleteByIdentifiers=function(e){return Promise.all(e.map((function(e){return u.deleteByIdentifier(e)})))},u.deleteApp=function(e){return Object(l.a)((o=Object(a.a)(u),Object(s.a)(n.prototype)),"delete",o).call(o,"/api/apps?appIdStr=".concat(e))},u.uploadAppPackage=function(e,t,c){return Object(l.a)((r=Object(a.a)(u),Object(s.a)(n.prototype)),"post",r).call(r,"/api/app",e,{onUploadProgress:t,timeout:1/0,signal:c})},u}return Object(c.a)(n)}(n(107).a),d=new u;t.a=d},692:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var c=n(6),i=n(42),a=n(37),o=n(0),r=n(250),l=n(24),s=n(153),u=n(135),d=n(253),b=n(1);function j(e){var t=e.parentId,n=Object(o.useState)(""),j=Object(c.a)(n,2),p=j[0],f=j[1],O=function(){f(""),e.onClose()};return Object(b.jsx)(u.b,{transparentTitleBg:!0,title:"regTemp.addDeviceGroup",open:e.open,onClose:O,onOk:function(){if(p){var n=r.f.createGroup({parentId:t,deviceGroupName:p});return n.then((function(t){e.onOk(),O()})),n}l.c.error("device.errors.needGroupName")},children:Object(b.jsxs)(i.a,{sx:{pl:2},className:"flex-start flex-wrap",children:[Object(b.jsx)(i.a,{sx:{width:300,mr:2},children:Object(b.jsx)(s.a,{name:"groupName",onChange:function(e){f(e.target.value)},label:"common.name",value:p,placeholder:Object(a.b)("regTemp.holders.groupName"),inputProps:{maxLength:12}})}),Object(b.jsx)(d.a,{content:"regTemp.max12Chars"})]})})}},693:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var c=n(5),i=n(3),a=n(0),o=n(915),r=n(993),l=n(8),s=n(83),u=n(64),d=n(42),b=n(995),j=n(354),p=n(555),f=n(51),O=n(37),m=n(43),x=n(47),v=n(1);function h(e){var t=a.forwardRef((function(t,n){var c,a,r=Object(m.c)(x.l),h=e.sx,g=void 0===h?{}:h,C=t.classes,S=t.className,I=t.label,E=t.nodeId,P=t.icon,T=t.expansionIcon,N=t.displayIcon,k=Object(o.a)(E),w=k.disabled,A=k.expanded,L=k.selected,y=k.focused,R=k.handleExpansion,D=k.handleSelection,G=k.preventSelection,_=P||T||N,F=function(e,t){e.stopPropagation(),t instanceof Function&&t()},M=Object(u.e)(r,.3);return Object(v.jsxs)(d.a,{className:Object(l.a)(S,C.root,(c={},Object(i.a)(c,C.expanded,A),Object(i.a)(c,C.selected,L),Object(i.a)(c,C.focused,y),Object(i.a)(c,C.disabled,w),c)),onMouseDown:function(e){G(e)},ref:n,sx:g,children:[Object(v.jsx)(d.a,{onClick:function(e){R(e)},className:C.iconContainer,children:_}),Object(v.jsxs)(d.a,{className:"flex",style:{flex:1,height:"100%",marginLeft:4,overflow:"hidden"},onClick:function(){e.ContentProps.onSelected&&e.ContentProps.onSelected({name:t.label,id:t.nodeId})},children:[Object(v.jsx)(f.a,{fontSize:32,icon:"ic_menu_device1",color:M}),Object(v.jsx)(s.a,{onClick:function(e){D(e)},component:"div",sx:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},className:C.label,children:I}),!1!==e.ContentProps.showAddButton&&Object(v.jsx)(b.a,{title:Object(O.b)("device.addGroup"),children:Object(v.jsx)(j.a,{onClick:function(t){return F(t,e.ContentProps.onAddClick)},className:"tree-item-operation flex",size:"small",children:Object(v.jsx)(f.a,{mr:0,icon:"ic_add1"})})}),e.ContentProps.onDetailClick&&Object(v.jsx)(j.a,{sx:{ml:0},onClick:function(t){return F(t,e.ContentProps.onDetailClick)},className:"tree-item-operation flex",size:"small",children:Object(v.jsx)(f.a,{mr:0,icon:"ic_look"})}),null===(a=e.ContentProps.operationComponents)||void 0===a?void 0:a.map((function(e){return e})),e.ContentProps.showRadio&&Object(v.jsx)(p.a,{onChange:function(t){return e.ContentProps.onChange(t)},checked:e.checked})]})]})}));return Object(v.jsx)(r.a,Object(c.a)({ContentComponent:t},e))}},705:function(e,t,n){"use strict";n.d(t,"b",(function(){return T})),n.d(t,"a",(function(){return N}));var c=n(6),i=n(5),a=n(1004),o=n(7),r=n(64),l=n(42),s=n(83),u=n(550),d=n(555),b=n(37),j=n(0),p=n(43),f=n(250),O=n(678),m=n(47),x=n(680),v=n(173),h=n(174),g=n(51),C=n(692),S=n(693),I=n(253),E=n(1),P={padding:"0 16px",boxShadow:"0px 1px 4px 2px rgb(44 57 127 / 12%)",marginBottom:12,borderRadius:4,height:56,width:360},T=Object(o.a)(a.a)((function(e){var t=e.theme;return{padding:"16px 32px","& .Mui-focused":{backgroundColor:"transparent !important"},"& .Mui-selected":{backgroundColor:Object(r.a)(t.palette.primary.main,.1)+" !important","& .tree-item-operation":{display:"block"}}}})),N=Object(o.a)(S.a)((function(e){e.theme;return{".MuiTreeItem-content":Object(i.a)(Object(i.a)({},P),{},{"& .tree-item-operation":{display:"none"},"&:hover .tree-item-operation":{display:"block !important"}}),"&:hover .MuiTreeItem-content":{}}})),k=Object(j.forwardRef)((function(e,t){var n=Object(j.useState)(""),a=Object(c.a)(n,2),o=a[0],r=a[1],S=Object(p.c)(m.c),k=Object(j.useState)([]),w=Object(c.a)(k,2),A=w[0],L=w[1],y=Object(j.useState)(""),R=Object(c.a)(y,2),D=R[0],G=R[1],_=Object(p.b)(),F=Object(p.c)(x.b),M=Object(j.useMemo)((function(){return[null===F||void 0===F?void 0:F.id]}),[]),B=Object(j.useState)((null===F||void 0===F?void 0:F.id)||null),W=Object(c.a)(B,2),V=W[0],z=W[1],U=Object(j.useState)(F),Y=Object(c.a)(U,2),q=Y[0],H=Y[1],J=Object(j.useState)(!1),K=Object(c.a)(J,2),X=K[0],Q=K[1],Z=Object(j.useCallback)((function(){_(Object(O.e)(q))}),[q,_]);Object(j.useEffect)((function(){return Z}),[Z]);var $=Object(j.useCallback)((function(){f.f.getAllGroupTree().then((function(e){e.success&&L(e.nodeList)}))}),[]);Object(j.useImperativeHandle)(t,(function(){return{validateForm:function(){return new Promise((function(e,t){Boolean(q)?e({}):e({message:"regTemp.groupRequired"})}))},isValid:Boolean(q),values:q}})),Object(j.useEffect)((function(){D?f.f.searchGroups({textSearch:D}).then((function(e){L(e)})):$()}),[D,$]);var ee,te=function e(t){var n,c=t.level%6,i=S[c];return Object(E.jsx)(N,{ContentProps:{avatarColor:i,onChange:function(e){return function(e,t){if(e.target.checked){var n=t.id,c=t.name;z(n),H({id:n,name:c})}}(e,t)},onAddClick:function(){return function(e){console.log(e),r(e.id),Q(!0)}(t)},showRadio:!0},checked:V===t.id,onClick:function(){return function(e){z(e.id)}(t)},nodeId:t.id,label:t.name,children:null===(n=t.child)||void 0===n?void 0:n.map((function(t){return e(t)}))},t.id)};return Object(E.jsxs)(l.a,{sx:{height:1,display:"flex",flexDirection:"column"},children:[Object(E.jsxs)(l.a,{className:"flex-start flex-wrap",children:[Object(E.jsx)(s.a,{sx:{mr:4},children:Object(b.b)("regTemp.linkGroupToTemp")}),Object(E.jsx)(v.a,{value:D,placeholder:"device.searchGroup",onChange:function(e){G(e)}})]}),Object(E.jsx)(u.a,{sx:{my:3}}),Object(E.jsxs)(l.a,{className:"flex-start flex-wrap",sx:{flex:1,alignItems:"flex-start",overflowY:"auto",minHeight:10},children:[Object(E.jsx)(l.a,{sx:{height:1,width:500,overflowY:"auto"},children:Object(E.jsxs)(T,{selected:V,defaultExpanded:M,defaultCollapseIcon:Object(E.jsx)(g.a,{icon:"ic_arrow_down"}),defaultExpandIcon:Object(E.jsx)(g.a,{icon:"ic_arrow_right"}),sx:{flexGrow:1,overflowY:"auto"},children:[A&&(ee=A,ee.map((function(e){return te(e)}))),!A.length&&Object(E.jsx)(h.a,{})]})}),Object(E.jsx)(u.a,{orientation:"vertical"}),Object(E.jsxs)(l.a,{sx:{flex:1,minWidth:400,p:4,pt:1},children:[Object(E.jsx)(s.a,{children:Object(b.b)("regTemp.selectedGroup")}),q&&Object(E.jsxs)(l.a,{className:"flex-between",style:Object(i.a)({},P),sx:{boxSizing:"border-box",my:3},children:[Object(E.jsx)(g.a,{primary:!0,fontSize:32,icon:"ic_menu_device1"}),Object(E.jsx)(s.a,{component:"div",children:q.name}),Object(E.jsx)(l.a,{sx:{flex:1}}),Object(E.jsx)(d.a,{checked:!0})]})]})]}),Object(E.jsx)(u.a,{sx:{my:3}}),Object(E.jsx)(l.a,{sx:{pb:3,mb:-1},className:"footer",children:Object(E.jsx)(I.a,{content:"regTemp.selectGroupAddTip"})}),Object(E.jsx)(C.a,{parentId:o,open:X,onClose:function(){Q(!1)},onOk:function(){$()}})]})}));t.c=k},719:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var c=n(6),i=n(0),a=n(250);function o(e){var t=Object(i.useState)(),n=Object(c.a)(t,2),o=n[0],r=n[1],l=Object(i.useState)(!1),s=Object(c.a)(l,2),u=s[0],d=s[1],b=Object(i.useCallback)((function(){d(!0),a.f.getAllDevicesWithGroupInfo(e).then((function(e){d(!1),r(e)})).catch((function(){d(!1)}))}),[d,e]);return Object(i.useEffect)((function(){b()}),[b]),{fetchDeviceLoading:u,deviceData:o}}},721:function(e,t,n){"use strict";var c;n.d(t,"e",(function(){return c})),n.d(t,"h",(function(){return r})),n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return s})),n.d(t,"f",(function(){return u})),function(e){e[e.OPERATIONS=0]="OPERATIONS",e[e.TARGETS=1]="TARGETS"}(c||(c={}));var i,a,o,r=[{tab:c.OPERATIONS,label:"pipe.stageConfig.OPERATIONS"},{tab:c.TARGETS,label:"pipe.stageConfig.TARGETS"}];!function(e){e[e.APPLICATION=0]="APPLICATION"}(i||(i={})),function(e){e[e.RUNS=0]="RUNS",e[e.PIPELINES=1]="PIPELINES"}(a||(a={})),function(e){e.PENDDING="01",e.PROCESSING="02",e.CANCELLED="03",e.AWAITING_PROMOTION="04",e.FAILED="05",e.SUCCESSFUL="06"}(o||(o={}));var l=new Map([[o.PROCESSING,{color:"#3F51B5",label:"pipe.logStatus.PROCESSING"}],[o.SUCCESSFUL,{color:"#4CAF50",label:"pipe.logStatus.SUCCESSFUL"}],[o.PENDDING,{color:"#0000008A",label:"pipe.logStatus.PENDDING"}],[o.AWAITING_PROMOTION,{color:"#0000008A",label:"pipe.logStatus.AWAITING_PROMOTION"}],[o.FAILED,{color:"#F44336",label:"pipe.logStatus.FAILED"}],[o.CANCELLED,{color:"#F44336",label:"pipe.logStatus.CANCELLED"}],[o.CANCELLED,{color:"#F44336",label:"pipe.logStatus.CANCELLED"}]]),s=[o.AWAITING_PROMOTION,o.PENDDING,o.PROCESSING],u=function(e){return[o.SUCCESSFUL,o.CANCELLED,o.FAILED].includes(e)}},728:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var c,i=n(23),a=n(5),o=n(6),r=n(42),l=n(83),s=n(689),u=n(134),d=n(655),b=n(354),j=n(37),p=n(0),f=n(43),O=n(250),m=n(47),x=n(173),v=n(174),h=n(51),g=n(682),C=n(705),S=n(45),I=n(138),E=n(671),P=n(719),T=n(139),N=n(1);!function(e){e[e.DEVICE=0]="DEVICE",e[e.GROUP=1]="GROUP"}(c||(c={}));var k=Object(p.forwardRef)((function(e,t){var n=Object(f.c)(m.c),k=Object(p.useState)([]),w=Object(o.a)(k,2),A=w[0],L=w[1],y=Object(p.useState)(e.selected||[]),R=Object(o.a)(y,2),D=R[0],G=R[1],_=Object(p.useState)([]),F=Object(o.a)(_,2),M=(F[0],F[1]),B=Object(p.useState)(c.GROUP),W=Object(o.a)(B,2),V=W[0],z=W[1],U=Object(p.useState)(""),Y=Object(o.a)(U,2),q=Y[0],H=Y[1],J=Object(p.useState)(new I.d(0,8,null,E.a.BY_CREATED_TIME)),K=Object(o.a)(J,2),X=K[0],Q=K[1],Z=Object(P.a)(X),$=Z.deviceData,ee=Z.fetchDeviceLoading,te=Object(p.useState)(""),ne=Object(o.a)(te,2),ce=ne[0],ie=ne[1];Object(p.useEffect)((function(){G(e.selected||[])}),[e.selected]);var ae=Object(p.useCallback)((function(){Promise.resolve().then((function(){e.onChange&&e.onChange()}))}),[e]),oe=Object(p.useCallback)((function(){O.f.getAllGroupTree().then((function(e){e.success&&L(e.nodeList),ie(e.nodeList[0].id)}))}),[]),re=Object(p.useCallback)((function(){O.f.getAllGroups().then((function(e){return M(e)}))}),[]);Object(p.useEffect)((function(){re()}),[re]),Object(p.useImperativeHandle)(t,(function(){return{getSelected:function(){return D},getDevicesAndGroupIds:function(){var e=[],t=[];return null===D||void 0===D||D.forEach((function(n){n.type===c.DEVICE?e.push(n.id):t.push(n.id)})),{deviceIdList:e,deviceGroupIdList:t}}}})),Object(p.useEffect)((function(){q?O.f.searchGroups({textSearch:q}).then((function(e){L(e)})):oe()}),[q,oe]);var le,se=V===c.DEVICE,ue=function(e){z(e)},de=Object(p.useCallback)((function(e){return D.some((function(t){return t.id===e}))}),[D]),be=Object(p.useCallback)((function(e){de(e.id)?G(D.filter((function(t){return t.id!==e.id}))):G([].concat(Object(i.a)(D),[{name:e.name||e.friendlyName,id:e.id,type:V}])),ae()}),[de,ae,D,V]),je=Object(p.useCallback)((function(e){var t="ic_add2",n=null,c="common.add";return de(e.id)&&(t="ic_failed",n="red",c="common.remove"),Object(N.jsxs)(r.a,{onClick:function(){return be(e)},className:"flex-start pointer",sx:{flexWrap:"nowrap"},children:[Object(N.jsx)(h.a,{primary:!0,color:n,icon:t}),Object(N.jsx)(l.a,{sx:{whiteSpace:"nowrap"},children:Object(j.b)(c)})]},0)}),[de,be]),pe=Object(p.useCallback)((function(e){var t,c=e.level%6,i=n[c];return Object(N.jsx)(C.a,{ContentProps:{avatarColor:i,showAddButton:!1,operationComponents:[je(e)]},nodeId:e.id,label:e.name,children:null===(t=e.child)||void 0===t?void 0:t.map((function(e){return pe(e)}))},e.id)}),[n,je]),fe=Object(p.useMemo)((function(){return[new S.a("friendlyName","file.deviceName"),new S.a("groupName","file.linkedGroup"),new S.d("operation",null,"right",130,(function(e){return je(e)}))]}),[je]);return Object(N.jsx)(p.Fragment,{children:Object(N.jsxs)(r.a,{sx:{py:1,pt:3,alignItems:"flex-start",width:1140},className:"flex",children:[Object(N.jsxs)(r.a,{sx:{width:560},children:[Object(N.jsxs)(r.a,{className:"flex-between",sx:{pl:6},children:[Object(N.jsxs)(r.a,{children:[Object(N.jsx)(x.a,{fullWidth:!0,sx:{display:se?"block":"none"},value:X.textSearch,placeholder:"device.searchDevice",onChange:function(e){Q(Object(a.a)(Object(a.a)({},X),{},{textSearch:e,page:0}))}}),Object(N.jsx)(x.a,{fullWidth:!0,sx:{display:se?"none":"block"},value:q,placeholder:"device.searchGroup",onChange:function(e){H(e)}})]}),Object(N.jsxs)(s.a,{sx:{ml:2},variant:"contained","aria-label":"outlined primary button group",children:[Object(N.jsx)(u.a,{variant:se?"text":"contained",onClick:function(){return ue(c.GROUP)},children:Object(j.b)("device.deviceGroup")}),Object(N.jsx)(u.a,{variant:se?"contained":"text",onClick:function(){return ue(c.DEVICE)},children:Object(j.b)("file.device")})]})]}),Object(N.jsxs)(r.a,{sx:{px:2,mt:2,height:480,overflow:"auto",borderRight:"1px solid #eee"},children:[ce&&Object(N.jsxs)(C.b,{defaultExpanded:[ce],defaultCollapseIcon:Object(N.jsx)(h.a,{icon:"ic_arrow_down"}),defaultExpandIcon:Object(N.jsx)(h.a,{icon:"ic_arrow_right"}),sx:{flexGrow:1,overflowY:"auto",display:se?"none":""},children:[A&&(le=A,le.map((function(e){return pe(e)}))),!A.length&&Object(N.jsx)(v.a,{})]}),!ce&&Object(N.jsx)(T.a,{size:"small",title:null}),Object(N.jsx)(r.a,{sx:{display:se?"":"none",height:1},children:Object(N.jsx)(S.g,{hideBoxShadow:!0,loading:ee,rows:null===$||void 0===$?void 0:$.data,totalPages:null===$||void 0===$?void 0:$.totalPages,columns:fe,pageSize:8,page:X.page,pageChange:function(e){Q(Object(a.a)(Object(a.a)({},X),{},{page:e}))}})})]})]}),Object(N.jsxs)(r.a,{sx:{flex:1,px:6,width:520},children:[Object(N.jsxs)(r.a,{className:"flex-between",children:[Object(N.jsx)(l.a,{children:Object(j.b)("file.selectedDevicesOrGroup")}),Object(N.jsx)(u.a,{onClick:function(){ae(),G([])},variant:"text",children:Object(j.b)("file.removeAll")})]}),Object(N.jsx)(r.a,{sx:{pt:4,height:460,overflowY:"auto"},children:Object(N.jsx)(d.a,{rowSpacing:2,container:!0,children:D.map((function(e){return Object(N.jsx)(d.a,{item:!0,xs:6,children:Object(N.jsx)(g.a,{sx:{mr:2,maxWidth:210},deleteIcon:Object(N.jsx)(b.a,{sx:{ml:1,mr:"0 !important"},children:Object(N.jsx)(h.a,{mr:0,pointer:!0,fontSize:12,icon:"ic_dialog_close"})}),onDelete:function(){return t=e.id,ae(),void G(D.filter((function(e){return e.id!==t})));var t},label:e.name})},e.id)}))})})]})]})})}));t.b=k},729:function(e,t,n){"use strict";var c=n(13),i=n(14),a=n(18),o=n(30),r=n(31),l=n(17),s=n(12),u=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(){var e,c,o,r,u,d,b,j,p,f,O,m,x,v,h,g,C,S;Object(i.a)(this,n);for(var I=arguments.length,E=new Array(I),P=0;P<I;P++)E[P]=arguments[P];return(S=t.call.apply(t,[this].concat(E))).createPipeline=function(t){return Object(l.a)((e=Object(a.a)(S),Object(s.a)(n.prototype)),"post",e).call(e,"/api/pipeline/create",t)},S.savePipeline=function(e){return Object(l.a)((c=Object(a.a)(S),Object(s.a)(n.prototype)),"put",c).call(c,"/api/pipeline",e)},S.deletePipeline=function(e){return Object(l.a)((o=Object(a.a)(S),Object(s.a)(n.prototype)),"delete",o).call(o,"/api/pipeline/".concat(e," "))},S.getPipelines=function(e){return Object(l.a)((r=Object(a.a)(S),Object(s.a)(n.prototype)),"get",r).call(r,"/api/pipelines",{params:e})},S.getPipelineDetail=function(e){return Object(l.a)((u=Object(a.a)(S),Object(s.a)(n.prototype)),"get",u).call(u,"/api/pipeline/".concat(e))},S.createPipelineStage=function(e){return Object(l.a)((d=Object(a.a)(S),Object(s.a)(n.prototype)),"post",d).call(d,"/api/pipelineStage/create",e)},S.savePipelineStage=function(e){return Object(l.a)((b=Object(a.a)(S),Object(s.a)(n.prototype)),"put",b).call(b,"/api/pipelineStage",e)},S.deletePipelineStage=function(e){return Object(l.a)((j=Object(a.a)(S),Object(s.a)(n.prototype)),"delete",j).call(j,"/api/pipelineStage/".concat(e))},S.runPipeline=function(e){return Object(l.a)((p=Object(a.a)(S),Object(s.a)(n.prototype)),"post",p).call(p,"/api/pipeline/run",e)},S.getPipelineRunLogs=function(e){return Object(l.a)((f=Object(a.a)(S),Object(s.a)(n.prototype)),"get",f).call(f,"/api/pipelineRunLogs",{params:e})},S.getRunsByPipelineId=function(e){return Object(l.a)((O=Object(a.a)(S),Object(s.a)(n.prototype)),"get",O).call(O,"/api/pipelineRunLog/history",{params:e})},S.cancelPipeRun=function(e){return Object(l.a)((m=Object(a.a)(S),Object(s.a)(n.prototype)),"post",m).call(m,"/api/pipeline/cancelPipeline",e)},S.getRunningRunByPipelineId=function(e){return Object(l.a)((x=Object(a.a)(S),Object(s.a)(n.prototype)),"get",x).call(x,"/api/pipeline/running/".concat(e))},S.getPipelineRunDetailByRunId=function(e){return Object(l.a)((v=Object(a.a)(S),Object(s.a)(n.prototype)),"get",v).call(v,"/api/pipelineRunLog/".concat(e))},S.getPipelineRunActions=function(e){return Object(l.a)((h=Object(a.a)(S),Object(s.a)(n.prototype)),"get",h).call(h,"/api/pipelineStageRunLog/actions",{params:e})},S.promoteToNextStage=function(e){return Object(l.a)((g=Object(a.a)(S),Object(s.a)(n.prototype)),"post",g).call(g,"/api/pipeline/promote",e)},S.cancelStageRun=function(e){return Object(l.a)((C=Object(a.a)(S),Object(s.a)(n.prototype)),"post",C).call(C,"/api/pipeline/cancelPipelineStage",e)},S}return Object(c.a)(n)}(n(107).a),d=new u;t.a=d},767:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var c=n(6),i=n(0),a=n(127),o=n(691),r=n(138);function l(){var e=Object(i.useState)([]),t=Object(c.a)(e,2),n=t[0],l=t[1],s=Object(i.useState)([]),u=Object(c.a)(s,2),d=u[0],b=u[1],j=Object(i.useState)(),p=Object(c.a)(j,2),f=p[0],O=p[1],m=Object(i.useState)(!0),x=Object(c.a)(m,2),v=x[0],h=x[1];Object(i.useEffect)((function(){o.a.getAppList(new r.d(0,r.c)).then((function(e){var t;h(!1);var n=new Map([]),c=[];b(e.data),null===(t=e.data)||void 0===t||t.forEach((function(e){var t,i=e.name,o=e.identifier;c.push({name:i,identifier:o,iconPathHttps:null===(t=e.appList[0])||void 0===t?void 0:t.iconPathHttps}),n.set(e.identifier,null===e||void 0===e?void 0:e.appList.map((function(e){return new a.a(e.versionName,e.versionName)})))})),l(c),O(n)})).catch((function(){h(!1)}))}),[]);var g=Object(i.useMemo)((function(){return n.map((function(e){return new a.a(e.identifier,e.name)}))}),[n]),C=Object(i.useCallback)((function(e){return(null===f||void 0===f?void 0:f.get(e))||[]}),[f]),S=Object(i.useCallback)((function(e,t){var n,c;if(t)return null===d||void 0===d||null===(n=d.find((function(t){return t.identifier===e})))||void 0===n||null===(c=n.appList)||void 0===c?void 0:c.find((function(e){return e.versionName===t}));var i,a=null===d||void 0===d||null===(i=d.find((function(t){return t.identifier===e})))||void 0===i?void 0:i.appList;return a&&a[0]?a[0]:null}),[d]);return{loading:v,appList:n,appSelectList:g,getAppVersionList:C,getAppDetail:S}}},832:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var c=n(5),i=n(154),a=n(135),o=n(93),r=n(153),l=n(42),s=n(0),u=n(24),d=n(1);function b(e){var t=e.dialogProps,n=e.detail,b=Object(i.a)({initialValues:{name:"",description:""},validateOnMount:!0,validationSchema:o.b({name:o.c().required("common.fillRequiredFields").max(60)}),onSubmit:function(e){return Promise.resolve()}});Object(s.useEffect)((function(){if(n&&t.open){var e=n.name,c=n.description;b.setValues({name:e,description:c})}}),[n,t.open]);var j=Object(s.useCallback)((function(e){return Object(c.a)(Object(c.a)({},b.getFieldProps(e)),{},{label:"common."+e,error:Boolean(b.errors[e]&&b.touched[e])})}),[b]);return Object(d.jsx)(a.b,Object(c.a)(Object(c.a)({fullWidth:!0},t),{},{onOk:function(){if(b.handleSubmit(),b.isValid)return t.onOk?t.onOk(b.values):void 0;u.c.error("common.fillRequiredFields")},onClose:function(){b.resetForm(),t&&t.onClose()},title:"pipe.editPipeProp",children:Object(d.jsxs)(l.a,{sx:{px:1.5,width:400,maxWidth:"calc(100% - 24px)"},children:[Object(d.jsx)(r.a,Object(c.a)(Object(c.a)({width:400},j("name")),{},{inputProps:{maxLength:60}})),Object(d.jsx)(r.a,Object(c.a)(Object(c.a)({sx:{mt:3},width:400},j("description")),{},{inputProps:{maxLength:80},maxRows:5,minRows:2,multiline:!0}))]})}))}},833:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var c=n(42),i=n(711),a=n(83),o=n(51),r=n(1);function l(e){var t=e.app,n=e.deleteApp;return Object(r.jsx)(c.a,{className:"with-border",sx:{mb:2,borderRadius:1,width:400},children:Object(r.jsxs)(c.a,{sx:{p:1.5,flexWrap:"nowrap"},className:"flex-start",children:[Object(r.jsx)(i.a,{src:t.iconPathHttps}),Object(r.jsxs)(c.a,{sx:{maxWidth:308,minWidth:308,width:308,pl:1.5},className:"border-box",children:[Object(r.jsx)(a.a,{className:"line-clamp",children:t.name}),Object(r.jsx)(a.a,{className:"line-clamp",variant:"subtitle1",children:t.versionName+" "+t.identifier})]}),n&&Object(r.jsx)(o.a,{onClick:function(){return n(t)},pointer:!0,color:"red",fontSize:20,icon:"ic_failed"})]})},t.identifier)}},976:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return U}));var c=n(5),i=n(6),a=n(42),o=n(83),r=n(134),l=n(550),s=n(995),u=n(968),d=n(997),b=n(0),j=n(171),p=n(721),f=n(24),O=n(127),m=n(51),x=n(711),v=n(767),h=n(135),g=n(1);function C(e){var t=e.dialogProps,n=Object(b.useState)(),r=Object(i.a)(n,2),l=r[0],s=r[1],u=Object(b.useState)(),d=Object(i.a)(u,2),j=d[0],p=d[1],m=Object(v.a)(),C=m.appSelectList,S=m.getAppVersionList,I=m.getAppDetail,E=Object(b.useCallback)((function(e){s(e.target.value)}),[]),P=Object(b.useCallback)((function(e){p(e.target.value)}),[]),T=Object(b.useMemo)((function(){return S(l)}),[l,S]);Object(b.useEffect)((function(){var e;p(null===(e=T[0])||void 0===e?void 0:e.value)}),[T]);var N=Object(b.useCallback)((function(){if(l&&j){var e=I(l,j);return t.onOk?t.onOk(e):void 0}f.c.error("pipe.appInfoRequired")}),[l,j,I,t]),k=Object(b.useCallback)((function(){s(null),p(null),t.onClose&&t.onClose()}),[t,s,p]),w=Object(b.useCallback)((function(e){var t=I(e);if(t)return Object(g.jsxs)(a.a,{className:"flex-start relative-position",children:[Object(g.jsx)(x.a,{sx:{height:24,width:24,left:0},className:"abs-position-important",src:t.iconPathHttps}),Object(g.jsx)(o.a,{sx:{ml:4},children:t.name})]})}),[I]);return Object(g.jsx)(h.b,Object(c.a)(Object(c.a)({},t),{},{title:"pipe.appSelection",size:"sm",onOk:N,onClose:k,fullWidth:!0,children:Object(g.jsxs)(a.a,{sx:{px:1.5,width:400,maxWidth:"calc(100% - 24px)"},children:[Object(g.jsx)(O.b,{fullWidth:!0,customRender:function(e){return w(e)},options:C,label:"device.selectApp",value:l,onChange:E}),Object(g.jsx)(O.b,{fullWidth:!0,sx:{mt:3},options:T,label:"device.selectAppVersion",value:j,onChange:P})]})}))}var S=n(7),I=n(64),E=n(684),P=Object(S.a)(a.a)((function(e){var t=e.theme;return{width:300,minWidth:300,borderRadius:t.shape.borderRadius,overflow:"hidden","& .selected-stage":{backgroundColor:Object(I.a)(t.palette.primary.main,.12)},"&:hover .stage-content":{backgroundColor:Object(I.a)(t.palette.primary.main,.08)}}}));function T(e){var t,n,c,i=Object(j.a)().t,r=e.selected,l=e.stage,s=l.serialNum,u=l.name,d=l.description,b=void 0===d?"":d,O="stage-content"+(r?" selected-stage":""),x=1===s,v=(null===(t=l.additionalInfo)||void 0===t?void 0:t.length)||0,h=(null===(n=l.extraInfo)||void 0===n||null===(c=n.targets)||void 0===c?void 0:c.length)||0;return Object(g.jsxs)(P,{onClick:function(){e.onClick&&e.onClick()},className:"with-border pointer",children:[Object(g.jsx)(a.a,{sx:{bgcolor:r?f.x:function(e){return e.palette.grey[400]},height:10}}),Object(g.jsxs)(a.a,{className:O,sx:{p:2,bgcolor:f.f},children:[Object(g.jsxs)(a.a,{className:"flex-between",children:[Object(g.jsx)(o.a,{variant:"subtitle1",children:i("pipe.stageIndex",{index:s})}),!x&&Object(g.jsx)(m.a,{onClick:function(t){t.stopPropagation(),e.onDelete&&e.onDelete()},icon:"ic_dialog_close",style:{fontWeight:"bold"},fontSize:14,className:"pointer"})]}),Object(g.jsx)(o.a,{sx:{mb:1,mt:.5},children:u}),Object(g.jsx)(o.a,{variant:"subtitle1",children:b}),Object(g.jsxs)(a.a,{sx:{mt:2},className:"flex-between",children:[Object(g.jsx)(E.a,{onClick:function(){return e.onConfig(p.e.OPERATIONS)},fontSize:14,underline:"hover",children:v?i("pipe.operationAppCount",{count:v}):i("pipe.addOperations")}),Object(g.jsx)(E.a,{onClick:function(){return e.onConfig(p.e.TARGETS)},fontSize:14,underline:"hover",children:h?i("pipe.targetCount",{count:h}):i("pipe.addTargets")})]})]})]})}var N,k=n(154),w=n(93),A=n(153);function L(e){var t=e.dialogProps,n=e.detail,i=Object(j.a)().t,o=Object(k.a)({initialValues:{name:"",description:""},validateOnMount:!0,validationSchema:w.b({name:w.c().required("common.fillRequiredFields").max(60),description:w.c().required("common.fillRequiredFields").max(80)}),onSubmit:function(){return Promise.resolve()}});Object(b.useEffect)((function(){if(n&&t.open){var e=n.name,c=n.description;o.setValues({name:e,description:c})}}),[n,t.open]);var r=i("pipe.stageCofigTitle",{name:n.name}),l=Object(b.useCallback)((function(e){return Object(c.a)(Object(c.a)({},o.getFieldProps(e)),{},{label:"common."+e,error:Boolean(o.errors[e]&&o.touched[e])})}),[o]);return Object(g.jsx)(h.b,Object(c.a)(Object(c.a)({fullWidth:!0},t),{},{onOk:function(){if(o.handleSubmit(),o.isValid)return t.onOk?t.onOk(o.values):void 0;f.c.error("common.fillRequiredFields")},onClose:function(){o.resetForm(),t&&t.onClose()},title:r,children:Object(g.jsxs)(a.a,{sx:{px:1.5,width:400,maxWidth:"calc(100% - 24px)"},children:[Object(g.jsx)(A.a,Object(c.a)(Object(c.a)({width:400},l("name")),{},{inputProps:{maxLength:60}})),Object(g.jsx)(A.a,Object(c.a)(Object(c.a)({sx:{mt:3},width:400},l("description")),{},{inputProps:{maxLength:80},maxRows:5,minRows:2,multiline:!0}))]})}))}!function(e){e[e.EDIT=0]="EDIT",e[e.CREATE=1]="CREATE"}(N||(N={}));var y=n(258),R=n(728);function D(e){var t=Object(j.a)().t,n=Object(b.useRef)(),c=Object(b.useState)(!1),r=Object(i.a)(c,2),l=r[0],s=r[1],u=Object(b.useCallback)((function(){var t,c;s(!0);var i=null===(t=n.current)||void 0===t?void 0:t.getSelected(),a=null===(c=n.current)||void 0===c?void 0:c.getDevicesAndGroupIds(),o=a.deviceIdList,r=a.deviceGroupIdList;e.setTargets({selectedItems:i,deviceIdList:o,deviceGroupIdList:r}).then((function(){setTimeout((function(){s(!1)}),100)})).catch((function(e){s(!1)}))}),[e]),d=Object(b.useCallback)((function(){u()}),[u]);return Object(g.jsxs)(a.a,{children:[Object(g.jsx)(a.a,{className:"flex-between",children:Object(g.jsx)(o.a,{children:t("pipe.selectTargets")})}),Object(g.jsxs)(a.a,{sx:{overflow:"auto"},className:"relative-position",children:[Object(g.jsx)(y.a,{loading:l}),Object(g.jsx)(R.b,{selected:e.selectedItems,ref:n,onChange:d})]})]})}var G=n(26),_=n(729),F=n(832),M=n(250),B=n(78),W=n(249),V=n(833),z=[new O.a(p.d.APPLICATION,"pipe.operations.APPLICATION")];function U(){var e,t=Object(j.a)().t,n=Object(G.m)(),x=Object(b.useState)(p.e.OPERATIONS),v=Object(i.a)(x,2),h=v[0],S=v[1],I=Object(b.useState)(p.d.APPLICATION),E=Object(i.a)(I,2),P=E[0],k=E[1],w=Object(b.useState)(!1),A=Object(i.a)(w,2),U=A[0],Y=A[1],q=Object(b.useState)(!1),H=Object(i.a)(q,2),J=H[0],K=H[1],X=Object(b.useState)(!1),Q=Object(i.a)(X,2),Z=Q[0],$=Q[1],ee=Object(b.useState)(N.CREATE),te=Object(i.a)(ee,2),ne=te[0],ce=te[1],ie=Object(b.useState)(!0),ae=Object(i.a)(ie,2),oe=ae[0],re=ae[1],le=Object(b.useState)(),se=Object(i.a)(le,2),ue=se[0],de=se[1],be=Object(b.useState)(),je=Object(i.a)(be,2),pe=je[0],fe=je[1],Oe=Object(b.useState)(!1),me=Object(i.a)(Oe,2),xe=me[0],ve=me[1],he=Object(G.o)().id,ge=Object(b.useCallback)((function(){_.a.getPipelineDetail(he).then((function(e){re(!1),de(e)})).catch((function(){re(!1)}))}),[he]),Ce=ge;Object(b.useEffect)((function(){ge()}),[ge]);var Se=Object(b.useMemo)((function(){return(null===ue||void 0===ue?void 0:ue.pipelineStageList)||[]}),[ue]),Ie=Object(b.useMemo)((function(){var e=(null===Se||void 0===Se?void 0:Se.length)||0,n=null===pe||void 0===pe?void 0:pe.serialNum,i=Se.length+1;return{stageCount:e,currentLevel:n,nextLevel:i,stageConfigDetail:ne===N.CREATE?{name:t("pipe.createStageName",{index:i}),description:t("pipe.createStageDescription",{index:i})}:Object(c.a)({},pe)}}),[Se,pe,ne,t]);Object(b.useEffect)((function(){Se.length&&fe(pe&&Se.find((function(e){return e.id===pe.id}))||Se[0])}),[Se,pe]);var Ee=Object(b.useCallback)((function(){K(!1)}),[]),Pe=ne===N.CREATE,Te=1===(null===pe||void 0===pe?void 0:pe.serialNum),Ne=Object(b.useCallback)((function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pe,n=null;if(Ie.stageCount>=1)if(t)n=(null===(e=Se[Ie.stageCount-1])||void 0===e?void 0:e.id)||null;else if(!Te){var c;n=(null===(c=Se[pe.serialNum-2])||void 0===c?void 0:c.id)||null}return n}),[Te,Pe,Ie,Se,null===pe||void 0===pe?void 0:pe.serialNum]),ke=Object(b.useCallback)((function(e){if(Pe){var t=_.a.createPipelineStage(Object(c.a)(Object(c.a)({},e),{},{pipelineId:he,parentId:Ne()}));return t.then((function(){Ce()})).catch((function(e){Object(f.p)(e)})),t}return _.a.savePipelineStage(Object(c.a)(Object(c.a)(Object(c.a)({},pe),e),{},{pipelineId:he,parentId:Ne(!1),rootNode:Te})).then((function(){Ce()})).catch((function(e){Object(f.p)(e)}))}),[pe,he,Ce,Ne,Te,Pe]),we=Object(b.useCallback)((function(){$(!1)}),[]),Ae=Object(b.useCallback)((function(e){var t=_.a.savePipeline(Object(c.a)(Object(c.a)({},e),{},{id:he}));return t.then((function(){Ce()})).catch((function(e){var t;(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)&&f.c.error(e.data.message)})),t}),[he,Ce]),Le=function(){ce(N.CREATE),K(!0)},ye=Object(b.useCallback)((function(e){fe(e)}),[]),Re=Object(b.useCallback)((function(e){var n=e.name,c=e.id;Object(f.a)({title:t("pipeline.deleteStageTitle",{name:n}),content:"common.deleteContent",okBtnColor:"error",okText:"common.delete",onOk:function(){var e=_.a.deletePipelineStage(c);return e.then((function(e){f.c.success("pipe.deleteStageSuccessed"),Ce()})),e}})}),[t,Ce]),De=function(e){S(e)},Ge=Object(b.useMemo)((function(){var e,t=null===pe||void 0===pe?void 0:pe.additionalInfo,n=(null===pe||void 0===pe||null===(e=pe.extraInfo)||void 0===e?void 0:e.targets)||[],i=n.filter((function(e){return e.type===R.a.DEVICE}))||[],a=n.filter((function(e){return e.type===R.a.GROUP}))||[],o={apps:[],deviceIdList:i.map((function(e){return e.id})),deviceGroupIdList:a.map((function(e){return e.id})),selectedItems:n};if(t&&t[0]){var r=t[0],l=r.deviceIdList,s=r.deviceGroupIdList,u=[];t.forEach((function(e){var t;null!==e&&void 0!==e&&null!==(t=e.taskParams)&&void 0!==t&&t.identifier&&u.push(e.taskParams)})),o=Object(c.a)(Object(c.a)({},o),{},{apps:u,deviceIdList:l,deviceGroupIdList:s})}return o}),[pe]),_e=Object(b.useCallback)((function(e,t){var n=t?t.name+" v"+t.versionName:"";return new M.a([],[],new B.s("installApp",e,B.i.INSTALL_APP,t,n),t)}),[]),Fe=Object(b.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ge;if(!pe)return Promise.resolve();var i=(null===pe||void 0===pe?void 0:pe.additionalInfo)||[];if("ADD_APP"===e){var a=i.some((function(e){var n;return t&&(null===(n=e.taskParams)||void 0===n?void 0:n.identifier)===t.identifier}));if(a)return f.c.error("pipe.appExisted"),Promise.reject();i.push(_e(null,t))}"DELETE_APP"===e&&(i=i.filter((function(e){var n;return(null===(n=e.taskParams)||void 0===n?void 0:n.identifier)!==(null===t||void 0===t?void 0:t.identifier)}))),i&&i.forEach((function(e){e.deviceIdList=n.deviceIdList,e.deviceGroupIdList=n.deviceGroupIdList,e.contentInfo.target=new B.t("devices-and-groups",null,null)}));var o=Object(c.a)(Object(c.a)({},pe),{},{additionalInfo:i,pipelineId:he,parentId:Ne(!1),rootNode:Te,extraInfo:{targets:null===n||void 0===n?void 0:n.selectedItems}}),r=_.a.savePipelineStage(o);return r.then((function(e){Ce()})).catch((function(e){Object(f.p)(e)})),r}),[he,Ne,Te,_e,Ce,pe,Ge]),Me=function(e){Fe("DELETE_APP",e)},Be=Object(b.useCallback)((function(){ve(!0),_.a.runPipeline({id:he}).then((function(e){ve(!1),f.c.success("pipe.startToRun"),n("/pipelines")})).catch((function(e){Object(f.p)(e),ve(!1)}))}),[he,n]);return Object(g.jsxs)(a.a,{className:"relative-position",sx:{height:1},children:[Object(g.jsx)(y.a,{loading:oe}),Object(g.jsxs)(a.a,{className:"border-box",sx:{px:3,mx:2,py:2,height:1,bgcolor:function(e){return e.custom.commonBg},overflowY:"auto"},children:[Object(g.jsxs)(a.a,{className:"flex-between",sx:{},children:[Object(g.jsx)(o.a,{children:null===ue||void 0===ue?void 0:ue.name}),Object(g.jsxs)(a.a,{children:[Object(g.jsx)(r.a,{onClick:function(){return $(!0)},sx:{mr:2},children:t("pipe.editProp")}),Object(g.jsx)(W.a,{loading:xe,onClick:Be,variant:"contained",children:Object(g.jsx)("span",{children:t("pipe.runPipe")})})]})]}),Object(g.jsx)(l.a,{sx:{my:2}}),Object(g.jsx)(a.a,{className:"with-border",sx:{borderRadius:1,bgcolor:"#f8f8f8"},children:Object(g.jsx)(a.a,{className:"flex-start",sx:{py:6,px:4,pr:12,overflowX:"auto",flexWrap:"nowrap",alignItems:"flex-start"},children:null===Se||void 0===Se?void 0:Se.map((function(e){return Object(g.jsxs)(b.Fragment,{children:[Object(g.jsx)(T,{onClick:function(){return ye(e)},onDelete:function(){return Re(e)},onConfig:De,selected:(null===pe||void 0===pe?void 0:pe.id)===e.id,stage:e}),e.serialNum<3&&Object(g.jsxs)(a.a,{sx:{alignSelf:"center"},className:"flex",children:[Object(g.jsx)(a.a,{sx:{borderTop:"1px dashed",borderTopColor:f.x,width:48}}),e.serialNum>=Se.length&&Object(g.jsx)(s.a,{placement:"top",title:t("pipe.addStage"),children:Object(g.jsx)(a.a,{children:Object(g.jsx)(m.a,{icon:"ic_add2",mr:0,className:"pointer",onClick:Le,primary:!0})})})]})]},e.id)}))})}),pe&&Object(g.jsxs)(b.Fragment,{children:[Object(g.jsxs)(a.a,{className:"flex-between",sx:{mt:3},children:[Object(g.jsx)(o.a,{children:t("pipe.stageIndex",{index:Ie.currentLevel})+": "+(null===pe||void 0===pe?void 0:pe.name)}),Object(g.jsx)(r.a,{onClick:function(){ce(N.EDIT),K(!0)},children:t("pipe.editStageProp")})]}),Object(g.jsxs)(a.a,{children:[Object(g.jsx)(u.a,{sx:{borderBottom:"1px solid",borderBottomColor:function(e){return e.custom.borderColor}},variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,value:h,onChange:function(e,t){S(t)},children:p.h.map((function(e){return Object(g.jsx)(d.a,{label:t(e.label)},e.tab)}))}),Object(g.jsxs)(a.a,{sx:{px:2,py:3},children:[h===p.e.OPERATIONS&&Object(g.jsxs)(a.a,{className:"flex-start",sx:{alignItems:"flex-start"},children:[Object(g.jsxs)(a.a,{sx:{width:360,pr:5,mr:4},className:"border-box",children:[Object(g.jsx)(O.b,{label:"pipe.stageOperationLabel",options:z,onChange:function(e){k(e.target.value)},value:P}),Object(g.jsx)(a.a,{sx:{py:2},className:"flex-end",children:Object(g.jsxs)(r.a,{onClick:function(){h===p.e.OPERATIONS&&Y(!0)},variant:"contained",children:["+ ",t("common.add")]})})]}),Object(g.jsxs)(a.a,{sx:{flex:1},children:[Object(g.jsx)(o.a,{sx:{pb:2,mr:1},children:t("pipe.selectedAppLabel",{count:null===(e=Ge.apps)||void 0===e?void 0:e.length})}),Ge.apps.map((function(e){return Object(g.jsx)(V.a,{app:e,deleteApp:Me},e.id)}))]})]}),h===p.e.TARGETS&&Object(g.jsx)(a.a,{children:Object(g.jsx)(D,{selectedItems:Ge.selectedItems,setTargets:function(e){return Fe("SET_TARGET",null,e)}})})]})]})]})]}),Object(g.jsx)(C,{dialogProps:{open:U,onOk:function(e){return Fe("ADD_APP",e)},onClose:function(){Y(!1)}}}),Object(g.jsx)(L,{type:ne,detail:Ie.stageConfigDetail,dialogProps:{open:J,onClose:Ee,onOk:ke}}),Object(g.jsx)(F.a,{dialogProps:{open:Z,onClose:we,onOk:Ae},detail:{name:null===ue||void 0===ue?void 0:ue.name,description:null===ue||void 0===ue?void 0:ue.description}})]})}}}]);
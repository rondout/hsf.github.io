(this["webpackJsonpui-ngx"]=this["webpackJsonpui-ngx"]||[]).push([[23],{671:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return I}));var c,a=n(42),o=n(83),i=n(134),r=n(354),l=n(674),s=n.n(l),u=n(673),d=n.n(u),b=n(43),j=n(36),f=n(47),O=n(173),p=n(155),m=n(37),x=n(672),h=n(106),v=n(251),g=n(104),C=n(0),E=n(1);!function(e){e.BY_TITLE="name",e.BY_CREATED_TIME="createdTime"}(c||(c={}));var S=[new j.e(c.BY_TITLE,"regTemp.sortBy.name"),new j.e(c.BY_CREATED_TIME,"regTemp.sortBy.createdTime")];function I(e){var t=e.sortProp,n=e.onSortChange,c=e.textSearch,l=e.onSearchChange,u=e.deleteDisabled,j=e.deleteTitle,I=e.addTitle,w=e.selectTitle,T=e.showSelectBtn,k=void 0!==T&&T,y=e.selectMode,N=void 0!==y&&y,_=e.authControl,D=void 0===_?"GENERAL":_,L=e.menus||S,G=Object(g.b)(),R=Object(g.a)(),A="GENERAL"===D?R:!G,M=Object(b.c)(f.a),P={add:!k||!N,delete:(!k||N)&&e.onDelete,select:k&&!N,selectAll:k&&N&&e.viewMode===x.a.CARD,cancel:k&&N};return Object(E.jsxs)(a.a,{sx:{mb:2,display:"flex",justifyContent:"space-between",height:36},children:[N&&Object(E.jsxs)(a.a,{className:"flex-start",children:[Object(E.jsx)(o.a,{fontSize:16,color:v.c,children:e.selectedCount}),Object(E.jsx)(o.a,{sx:{ml:1},children:Object(m.b)("common.selected")})]}),!N&&Object(E.jsxs)(a.a,{className:"flex-start",children:[void 0!==e.viewMode&&Object(E.jsx)(x.b,{items:x.c,mode:e.viewMode,onChange:e.onViewModeChange}),M?null:Object(E.jsx)(p.a,{title:"regTemp.sortBy."+t,selected:t,menus:L,onMenuClick:n}),Object(E.jsx)(O.a,{sx:{ml:M?0:2,bgcolor:"#fff"},value:c,onChange:l})]}),A&&Object(E.jsx)(C.Fragment,{children:M?Object(E.jsxs)(a.a,{children:[Object(E.jsx)(r.a,{onClick:e.onAdd,size:"medium",edge:"start",color:"primary","aria-label":"open drawer",sx:{mr:1},children:Object(E.jsx)(d.a,{})}),Object(E.jsx)(r.a,{onClick:e.onDelete,disabled:u,size:"medium",edge:"start",color:"error","aria-label":"open drawer",children:Object(E.jsx)(s.a,{})})]}):Object(E.jsxs)(a.a,{children:[P.add&&Object(E.jsx)(i.a,{onClick:e.onAdd,variant:"contained",children:Object(m.b)(I)}),P.cancel&&Object(E.jsx)(i.a,{onClick:function(){e.selectAll(!1),e.setSelectMode(!1)},variant:"outlined",children:Object(m.b)("common.cancel")}),P.selectAll&&Object(E.jsx)(h.a,{sx:{ml:2},onClick:function(){e.selectAll&&e.selectAll(!0)},children:Object(m.b)("common.selectAll")}),P.select&&Object(E.jsx)(h.a,{sx:{ml:2},onClick:function(){var t;void 0!==t?e.setSelectMode(t):e.setSelectMode(!N)},children:Object(m.b)(w)}),P.delete&&Object(E.jsx)(i.a,{onClick:e.onDelete,disabled:u,sx:{ml:2},variant:void 0!==e.viewMode?"contained":"outlined",children:Object(m.b)(j)})]})})]})}},672:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return O}));var c,a=n(5),o=n(7),i=n(134),r=n(64),l=n(689),s=n(995),u=n(171),d=n(51),b=n(1),j=Object(o.a)(i.a)((function(e){var t=e.theme;return{height:36,borderColor:t.palette.action.disabled,"&:hover":{borderColor:t.palette.action.disabled},"&.checked":{backgroundColor:Object(r.a)(t.palette.primary.main,.32)},"&.checked:hover":{backgroundColor:Object(r.a)(t.palette.primary.main,.32)}}}));!function(e){e[e.LIST=0]="LIST",e[e.CARD=1]="CARD"}(c||(c={}));var f=[{icon:"ic_viewmodule",value:c.CARD,label:"common.cardView"},{icon:"ic_viewheadline",value:c.LIST,label:"common.listView"}];function O(e){var t=e.mode,n=e.onChange,c=e.items,o=void 0===c?[]:c,i=e.sx,r=void 0===i?{}:i,f=Object(u.a)().t;return Object(b.jsx)(l.a,{sx:Object(a.a)({mr:2},r),children:o.map((function(e){return Object(b.jsx)(s.a,{title:f(e.label),children:Object(b.jsx)(j,{size:"small",onClick:function(){var c;(c=e.value)!==t&&n(c)},className:t===e.value?"checked":"",sx:{px:1},children:Object(b.jsx)(d.a,{color:"rgba(0, 0, 0, 0.54)",mr:0,icon:e.icon})})},e.label)}))})}},678:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"i",(function(){return r})),n.d(t,"g",(function(){return l})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return b}));var c=n(29),a=function(e){return{type:c.d.INIT_CONFIG_DETAIL,data:e}},o=function(){return{type:c.d.RESET_CONFIG}},i=function(e){return{type:c.d.SET_BASIC_CONFIG,data:e}},r=function(e){return{type:c.d.SET_SETTINGS_CONFIG,data:e}},l=function(e){return{type:c.d.SET_KIOSK_INFO,data:e}},s=function(e){return{type:c.d.SET_DEVICE_CONFIG,data:e}},u=function(e){return{type:c.d.SET_PART_DEVICE_CONFIG,data:e}},d=function(e){return{type:c.d.SET_DEVICE_GROUP,data:e}},b=function(e){return{type:c.d.SET_DEVICE_POOL,data:e}}},680:function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"g",(function(){return i})),n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return b}));var c=n(84),a=function(e){return e.regTemp.regTempDetail},o=function(e){var t=e.regTemp.regTempDetail;return{name:t.name,description:t.description}},i=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.setting},r=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.kiosk},l=function(e){var t,n=null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.config;return n.wifiForProvision||(n.wifiForProvision=c.w),n},s=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.deviceGroup},u=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.deviceSnPool},d=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.setting.adb},b=function(e){var t;return null===(t=e.regTemp.regTempDetail)||void 0===t?void 0:t.contentInfo.setting.bluetooth}},682:function(e,t,n){"use strict";var c=n(7),a=n(656),o=n(64),i=Object(c.a)(a.a)((function(e){var t=e.theme;return{backgroundColor:Object(o.a)(t.palette.primary.main,.08),color:t.palette.primary.main,fontSize:14,paddingRight:6}}));t.a=i},692:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var c=n(6),a=n(42),o=n(37),i=n(0),r=n(250),l=n(24),s=n(153),u=n(135),d=n(253),b=n(1);function j(e){var t=e.parentId,n=Object(i.useState)(""),j=Object(c.a)(n,2),f=j[0],O=j[1],p=function(){O(""),e.onClose()};return Object(b.jsx)(u.b,{transparentTitleBg:!0,title:"regTemp.addDeviceGroup",open:e.open,onClose:p,onOk:function(){if(f){var n=r.f.createGroup({parentId:t,deviceGroupName:f});return n.then((function(t){e.onOk(),p()})),n}l.c.error("device.errors.needGroupName")},children:Object(b.jsxs)(a.a,{sx:{pl:2},className:"flex-start flex-wrap",children:[Object(b.jsx)(a.a,{sx:{width:300,mr:2},children:Object(b.jsx)(s.a,{name:"groupName",onChange:function(e){O(e.target.value)},label:"common.name",value:f,placeholder:Object(o.b)("regTemp.holders.groupName"),inputProps:{maxLength:12}})}),Object(b.jsx)(d.a,{content:"regTemp.max12Chars"})]})})}},693:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var c=n(5),a=n(3),o=n(0),i=n(915),r=n(993),l=n(8),s=n(83),u=n(64),d=n(42),b=n(995),j=n(354),f=n(555),O=n(51),p=n(37),m=n(43),x=n(47),h=n(1);function v(e){var t=o.forwardRef((function(t,n){var c,o,r=Object(m.c)(x.l),v=e.sx,g=void 0===v?{}:v,C=t.classes,E=t.className,S=t.label,I=t.nodeId,w=t.icon,T=t.expansionIcon,k=t.displayIcon,y=Object(i.a)(I),N=y.disabled,_=y.expanded,D=y.selected,L=y.focused,G=y.handleExpansion,R=y.handleSelection,A=y.preventSelection,M=w||T||k,P=function(e,t){e.stopPropagation(),t instanceof Function&&t()},F=Object(u.e)(r,.3);return Object(h.jsxs)(d.a,{className:Object(l.a)(E,C.root,(c={},Object(a.a)(c,C.expanded,_),Object(a.a)(c,C.selected,D),Object(a.a)(c,C.focused,L),Object(a.a)(c,C.disabled,N),c)),onMouseDown:function(e){A(e)},ref:n,sx:g,children:[Object(h.jsx)(d.a,{onClick:function(e){G(e)},className:C.iconContainer,children:M}),Object(h.jsxs)(d.a,{className:"flex",style:{flex:1,height:"100%",marginLeft:4,overflow:"hidden"},onClick:function(){e.ContentProps.onSelected&&e.ContentProps.onSelected({name:t.label,id:t.nodeId})},children:[Object(h.jsx)(O.a,{fontSize:32,icon:"ic_menu_device1",color:F}),Object(h.jsx)(s.a,{onClick:function(e){R(e)},component:"div",sx:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},className:C.label,children:S}),!1!==e.ContentProps.showAddButton&&Object(h.jsx)(b.a,{title:Object(p.b)("device.addGroup"),children:Object(h.jsx)(j.a,{onClick:function(t){return P(t,e.ContentProps.onAddClick)},className:"tree-item-operation flex",size:"small",children:Object(h.jsx)(O.a,{mr:0,icon:"ic_add1"})})}),e.ContentProps.onDetailClick&&Object(h.jsx)(j.a,{sx:{ml:0},onClick:function(t){return P(t,e.ContentProps.onDetailClick)},className:"tree-item-operation flex",size:"small",children:Object(h.jsx)(O.a,{mr:0,icon:"ic_look"})}),null===(o=e.ContentProps.operationComponents)||void 0===o?void 0:o.map((function(e){return e})),e.ContentProps.showRadio&&Object(h.jsx)(f.a,{onChange:function(t){return e.ContentProps.onChange(t)},checked:e.checked})]})]})}));return Object(h.jsx)(r.a,Object(c.a)({ContentComponent:t},e))}},705:function(e,t,n){"use strict";n.d(t,"b",(function(){return T})),n.d(t,"a",(function(){return k}));var c=n(6),a=n(5),o=n(1004),i=n(7),r=n(64),l=n(42),s=n(83),u=n(550),d=n(555),b=n(37),j=n(0),f=n(43),O=n(250),p=n(678),m=n(47),x=n(680),h=n(173),v=n(174),g=n(51),C=n(692),E=n(693),S=n(253),I=n(1),w={padding:"0 16px",boxShadow:"0px 1px 4px 2px rgb(44 57 127 / 12%)",marginBottom:12,borderRadius:4,height:56,width:360},T=Object(i.a)(o.a)((function(e){var t=e.theme;return{padding:"16px 32px","& .Mui-focused":{backgroundColor:"transparent !important"},"& .Mui-selected":{backgroundColor:Object(r.a)(t.palette.primary.main,.1)+" !important","& .tree-item-operation":{display:"block"}}}})),k=Object(i.a)(E.a)((function(e){e.theme;return{".MuiTreeItem-content":Object(a.a)(Object(a.a)({},w),{},{"& .tree-item-operation":{display:"none"},"&:hover .tree-item-operation":{display:"block !important"}}),"&:hover .MuiTreeItem-content":{}}})),y=Object(j.forwardRef)((function(e,t){var n=Object(j.useState)(""),o=Object(c.a)(n,2),i=o[0],r=o[1],E=Object(f.c)(m.c),y=Object(j.useState)([]),N=Object(c.a)(y,2),_=N[0],D=N[1],L=Object(j.useState)(""),G=Object(c.a)(L,2),R=G[0],A=G[1],M=Object(f.b)(),P=Object(f.c)(x.b),F=Object(j.useMemo)((function(){return[null===P||void 0===P?void 0:P.id]}),[]),V=Object(j.useState)((null===P||void 0===P?void 0:P.id)||null),B=Object(c.a)(V,2),z=B[0],q=B[1],W=Object(j.useState)(P),Y=Object(c.a)(W,2),U=Y[0],K=Y[1],H=Object(j.useState)(!1),Z=Object(c.a)(H,2),J=Z[0],Q=Z[1],X=Object(j.useCallback)((function(){M(Object(p.e)(U))}),[U,M]);Object(j.useEffect)((function(){return X}),[X]);var $=Object(j.useCallback)((function(){O.f.getAllGroupTree().then((function(e){e.success&&D(e.nodeList)}))}),[]);Object(j.useImperativeHandle)(t,(function(){return{validateForm:function(){return new Promise((function(e,t){Boolean(U)?e({}):e({message:"regTemp.groupRequired"})}))},isValid:Boolean(U),values:U}})),Object(j.useEffect)((function(){R?O.f.searchGroups({textSearch:R}).then((function(e){D(e)})):$()}),[R,$]);var ee,te=function e(t){var n,c=t.level%6,a=E[c];return Object(I.jsx)(k,{ContentProps:{avatarColor:a,onChange:function(e){return function(e,t){if(e.target.checked){var n=t.id,c=t.name;q(n),K({id:n,name:c})}}(e,t)},onAddClick:function(){return function(e){console.log(e),r(e.id),Q(!0)}(t)},showRadio:!0},checked:z===t.id,onClick:function(){return function(e){q(e.id)}(t)},nodeId:t.id,label:t.name,children:null===(n=t.child)||void 0===n?void 0:n.map((function(t){return e(t)}))},t.id)};return Object(I.jsxs)(l.a,{sx:{height:1,display:"flex",flexDirection:"column"},children:[Object(I.jsxs)(l.a,{className:"flex-start flex-wrap",children:[Object(I.jsx)(s.a,{sx:{mr:4},children:Object(b.b)("regTemp.linkGroupToTemp")}),Object(I.jsx)(h.a,{value:R,placeholder:"device.searchGroup",onChange:function(e){A(e)}})]}),Object(I.jsx)(u.a,{sx:{my:3}}),Object(I.jsxs)(l.a,{className:"flex-start flex-wrap",sx:{flex:1,alignItems:"flex-start",overflowY:"auto",minHeight:10},children:[Object(I.jsx)(l.a,{sx:{height:1,width:500,overflowY:"auto"},children:Object(I.jsxs)(T,{selected:z,defaultExpanded:F,defaultCollapseIcon:Object(I.jsx)(g.a,{icon:"ic_arrow_down"}),defaultExpandIcon:Object(I.jsx)(g.a,{icon:"ic_arrow_right"}),sx:{flexGrow:1,overflowY:"auto"},children:[_&&(ee=_,ee.map((function(e){return te(e)}))),!_.length&&Object(I.jsx)(v.a,{})]})}),Object(I.jsx)(u.a,{orientation:"vertical"}),Object(I.jsxs)(l.a,{sx:{flex:1,minWidth:400,p:4,pt:1},children:[Object(I.jsx)(s.a,{children:Object(b.b)("regTemp.selectedGroup")}),U&&Object(I.jsxs)(l.a,{className:"flex-between",style:Object(a.a)({},w),sx:{boxSizing:"border-box",my:3},children:[Object(I.jsx)(g.a,{primary:!0,fontSize:32,icon:"ic_menu_device1"}),Object(I.jsx)(s.a,{component:"div",children:U.name}),Object(I.jsx)(l.a,{sx:{flex:1}}),Object(I.jsx)(d.a,{checked:!0})]})]})]}),Object(I.jsx)(u.a,{sx:{my:3}}),Object(I.jsx)(l.a,{sx:{pb:3,mb:-1},className:"footer",children:Object(I.jsx)(S.a,{content:"regTemp.selectGroupAddTip"})}),Object(I.jsx)(C.a,{parentId:i,open:J,onClose:function(){Q(!1)},onOk:function(){$()}})]})}));t.c=y},718:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var c=n(6),a=n(259),o=n.n(a),i=n(0);function r(e){var t=Object(i.useState)(),n=Object(c.a)(t,2),a=n[0],r=n[1],l=Object(i.useState)(),s=Object(c.a)(l,2),u=s[0],d=s[1];Object(i.useEffect)((function(){var t=document.getElementById(e.id),n=[t.clientWidth,t.clientHeight];d({width:n[0],height:n[1]})}),[e.id]),Object(i.useEffect)((function(){if(!a){var t=function(e){var t=e.id,n=e.center,c=void 0===n?[30.636088,.990693]:n,a=e.zoom,i=void 0===a?2:a,r=e.minZoom,l=void 0===r?2:r,s=o.a.map(t).setView(c,i);return o.a.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:18,minZoom:l}).addTo(s),s.setMaxBounds(o.a.latLngBounds(o.a.latLng(-90,-360),o.a.latLng(90,360))),s}(e);r(t)}}),[a,e]);var b=Object(i.useCallback)((function(e){var t=o.a.markerClusterGroup();t.addLayers(e),null===a||void 0===a||a.addLayer(t)}),[a]),j=Object(i.useCallback)((function(e){if(!e)return null;var t=Object(c.a)(e,2),n=t[0],a=t[1];return"[".concat(n.toFixed(6),", ").concat(a.toFixed(6),"]")}),[]),f=Object(i.useCallback)((function(e){if(!e||!u)return{display:"none"};var t=e.x,n=e.y,c=u.height;return n>=c-40&&(n=c-40),{display:"block",top:n+15+"px",left:t+15+"px"}}),[u]);return{map:a,clustMarker:b,getMapInforTextFromLatlng:j,getInforStyle:f}}},719:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var c=n(6),a=n(0),o=n(250);function i(e){var t=Object(a.useState)(),n=Object(c.a)(t,2),i=n[0],r=n[1],l=Object(a.useState)(!1),s=Object(c.a)(l,2),u=s[0],d=s[1],b=Object(a.useCallback)((function(){d(!0),o.f.getAllDevicesWithGroupInfo(e).then((function(e){d(!1),r(e)})).catch((function(){d(!1)}))}),[d,e]);return Object(a.useEffect)((function(){b()}),[b]),{fetchDeviceLoading:u,deviceData:i}}},728:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var c,a=n(23),o=n(5),i=n(6),r=n(42),l=n(83),s=n(689),u=n(134),d=n(655),b=n(354),j=n(37),f=n(0),O=n(43),p=n(250),m=n(47),x=n(173),h=n(174),v=n(51),g=n(682),C=n(705),E=n(45),S=n(138),I=n(671),w=n(719),T=n(139),k=n(1);!function(e){e[e.DEVICE=0]="DEVICE",e[e.GROUP=1]="GROUP"}(c||(c={}));var y=Object(f.forwardRef)((function(e,t){var n=Object(O.c)(m.c),y=Object(f.useState)([]),N=Object(i.a)(y,2),_=N[0],D=N[1],L=Object(f.useState)(e.selected||[]),G=Object(i.a)(L,2),R=G[0],A=G[1],M=Object(f.useState)([]),P=Object(i.a)(M,2),F=(P[0],P[1]),V=Object(f.useState)(c.GROUP),B=Object(i.a)(V,2),z=B[0],q=B[1],W=Object(f.useState)(""),Y=Object(i.a)(W,2),U=Y[0],K=Y[1],H=Object(f.useState)(new S.d(0,8,null,I.a.BY_CREATED_TIME)),Z=Object(i.a)(H,2),J=Z[0],Q=Z[1],X=Object(w.a)(J),$=X.deviceData,ee=X.fetchDeviceLoading,te=Object(f.useState)(""),ne=Object(i.a)(te,2),ce=ne[0],ae=ne[1];Object(f.useEffect)((function(){A(e.selected||[])}),[e.selected]);var oe=Object(f.useCallback)((function(){Promise.resolve().then((function(){e.onChange&&e.onChange()}))}),[e]),ie=Object(f.useCallback)((function(){p.f.getAllGroupTree().then((function(e){e.success&&D(e.nodeList),ae(e.nodeList[0].id)}))}),[]),re=Object(f.useCallback)((function(){p.f.getAllGroups().then((function(e){return F(e)}))}),[]);Object(f.useEffect)((function(){re()}),[re]),Object(f.useImperativeHandle)(t,(function(){return{getSelected:function(){return R},getDevicesAndGroupIds:function(){var e=[],t=[];return null===R||void 0===R||R.forEach((function(n){n.type===c.DEVICE?e.push(n.id):t.push(n.id)})),{deviceIdList:e,deviceGroupIdList:t}}}})),Object(f.useEffect)((function(){U?p.f.searchGroups({textSearch:U}).then((function(e){D(e)})):ie()}),[U,ie]);var le,se=z===c.DEVICE,ue=function(e){q(e)},de=Object(f.useCallback)((function(e){return R.some((function(t){return t.id===e}))}),[R]),be=Object(f.useCallback)((function(e){de(e.id)?A(R.filter((function(t){return t.id!==e.id}))):A([].concat(Object(a.a)(R),[{name:e.name||e.friendlyName,id:e.id,type:z}])),oe()}),[de,oe,R,z]),je=Object(f.useCallback)((function(e){var t="ic_add2",n=null,c="common.add";return de(e.id)&&(t="ic_failed",n="red",c="common.remove"),Object(k.jsxs)(r.a,{onClick:function(){return be(e)},className:"flex-start pointer",sx:{flexWrap:"nowrap"},children:[Object(k.jsx)(v.a,{primary:!0,color:n,icon:t}),Object(k.jsx)(l.a,{sx:{whiteSpace:"nowrap"},children:Object(j.b)(c)})]},0)}),[de,be]),fe=Object(f.useCallback)((function(e){var t,c=e.level%6,a=n[c];return Object(k.jsx)(C.a,{ContentProps:{avatarColor:a,showAddButton:!1,operationComponents:[je(e)]},nodeId:e.id,label:e.name,children:null===(t=e.child)||void 0===t?void 0:t.map((function(e){return fe(e)}))},e.id)}),[n,je]),Oe=Object(f.useMemo)((function(){return[new E.a("friendlyName","file.deviceName"),new E.a("groupName","file.linkedGroup"),new E.d("operation",null,"right",130,(function(e){return je(e)}))]}),[je]);return Object(k.jsx)(f.Fragment,{children:Object(k.jsxs)(r.a,{sx:{py:1,pt:3,alignItems:"flex-start",width:1140},className:"flex",children:[Object(k.jsxs)(r.a,{sx:{width:560},children:[Object(k.jsxs)(r.a,{className:"flex-between",sx:{pl:6},children:[Object(k.jsxs)(r.a,{children:[Object(k.jsx)(x.a,{fullWidth:!0,sx:{display:se?"block":"none"},value:J.textSearch,placeholder:"device.searchDevice",onChange:function(e){Q(Object(o.a)(Object(o.a)({},J),{},{textSearch:e,page:0}))}}),Object(k.jsx)(x.a,{fullWidth:!0,sx:{display:se?"none":"block"},value:U,placeholder:"device.searchGroup",onChange:function(e){K(e)}})]}),Object(k.jsxs)(s.a,{sx:{ml:2},variant:"contained","aria-label":"outlined primary button group",children:[Object(k.jsx)(u.a,{variant:se?"text":"contained",onClick:function(){return ue(c.GROUP)},children:Object(j.b)("device.deviceGroup")}),Object(k.jsx)(u.a,{variant:se?"contained":"text",onClick:function(){return ue(c.DEVICE)},children:Object(j.b)("file.device")})]})]}),Object(k.jsxs)(r.a,{sx:{px:2,mt:2,height:480,overflow:"auto",borderRight:"1px solid #eee"},children:[ce&&Object(k.jsxs)(C.b,{defaultExpanded:[ce],defaultCollapseIcon:Object(k.jsx)(v.a,{icon:"ic_arrow_down"}),defaultExpandIcon:Object(k.jsx)(v.a,{icon:"ic_arrow_right"}),sx:{flexGrow:1,overflowY:"auto",display:se?"none":""},children:[_&&(le=_,le.map((function(e){return fe(e)}))),!_.length&&Object(k.jsx)(h.a,{})]}),!ce&&Object(k.jsx)(T.a,{size:"small",title:null}),Object(k.jsx)(r.a,{sx:{display:se?"":"none",height:1},children:Object(k.jsx)(E.g,{hideBoxShadow:!0,loading:ee,rows:null===$||void 0===$?void 0:$.data,totalPages:null===$||void 0===$?void 0:$.totalPages,columns:Oe,pageSize:8,page:J.page,pageChange:function(e){Q(Object(o.a)(Object(o.a)({},J),{},{page:e}))}})})]})]}),Object(k.jsxs)(r.a,{sx:{flex:1,px:6,width:520},children:[Object(k.jsxs)(r.a,{className:"flex-between",children:[Object(k.jsx)(l.a,{children:Object(j.b)("file.selectedDevicesOrGroup")}),Object(k.jsx)(u.a,{onClick:function(){oe(),A([])},variant:"text",children:Object(j.b)("file.removeAll")})]}),Object(k.jsx)(r.a,{sx:{pt:4,height:460,overflowY:"auto"},children:Object(k.jsx)(d.a,{rowSpacing:2,container:!0,children:R.map((function(e){return Object(k.jsx)(d.a,{item:!0,xs:6,children:Object(k.jsx)(g.a,{sx:{mr:2,maxWidth:210},deleteIcon:Object(k.jsx)(b.a,{sx:{ml:1,mr:"0 !important"},children:Object(k.jsx)(v.a,{mr:0,pointer:!0,fontSize:12,icon:"ic_dialog_close"})}),onDelete:function(){return t=e.id,oe(),void A(R.filter((function(e){return e.id!==t})));var t},label:e.name})},e.id)}))})})]})]})})}));t.b=y},735:function(e,t,n){"use strict";var c=n(5),a=n(7),o=n(356),i=n(64),r=n(172),l=n(835),s=n(42),u=n(217),d=n(37),b=n(0),j=n(1),f=Object(a.a)(o.a)((function(e){e.theme;return{"\t.MuiFormControlLabel-label":{whiteSpace:"nowrap",display:"inline-block",marginRight:16}}})),O=Object(u.a)((function(e){return{valueContainer:{minWidth:45,fontSize:14,marginLeft:8,height:32,borderRadius:16,backgroundColor:Object(i.a)(e.palette.primary.main,.08),color:e.palette.primary.main}}}));t.a=Object(b.memo)((function(e){var t=O(),n=e.valueLabelDisplay,a=void 0===n?"auto":n,o=e.inputProps,i=e.max,u=void 0===i?100:i,b=e.min,p=void 0===b?0:b;return Object(j.jsxs)(r.a,{fullWidth:!0,sx:{flexDirection:"row",maxWidth:o.width||1,height:1,alignItems:"center",pl:0},children:[Object(j.jsx)(f,{sx:{whiteSpace:"nowrap",mr:1,flex:1,ml:0},labelPlacement:"start",label:Object(d.b)(o.label),control:Object(j.jsx)(l.a,Object(c.a)(Object(c.a)({size:"small"},o),{},{valueLabelDisplay:a,max:u,min:p}))}),Object(j.jsx)(s.a,{className:t.valueContainer+" flex",children:e.customLabel||o.value+"%"})]})}))},738:function(e,t,n){"use strict";var c=n(13),a=n(14),o=n(18),i=n(30),r=n(31),l=n(17),s=n(12),u=function(e){Object(i.a)(n,e);var t=Object(r.a)(n);function n(){var e,c,i,r,u,d,b,j,f,O,p;Object(a.a)(this,n);for(var m=arguments.length,x=new Array(m),h=0;h<m;h++)x[h]=arguments[h];return(p=t.call.apply(t,[this].concat(x))).search=function(t){return Object(l.a)((e=Object(o.a)(p),Object(s.a)(n.prototype)),"get",e).call(e,"https://nominatim.openstreetmap.org/search?format=json&q="+t)},p.searchReverse=function(e){return Object(l.a)((c=Object(o.a)(p),Object(s.a)(n.prototype)),"get",c).call(c,"https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e[0],"&lon=").concat(e[1]))},p.createGeofence=function(e){return Object(l.a)((i=Object(o.a)(p),Object(s.a)(n.prototype)),"post",i).call(i,"/api/geofencing/create",e)},p.updateGeofence=function(e){return Object(l.a)((r=Object(o.a)(p),Object(s.a)(n.prototype)),"put",r).call(r,"/api/geofencing",e)},p.deleteGeofence=function(e){return Object(l.a)((u=Object(o.a)(p),Object(s.a)(n.prototype)),"post",u).call(u,"/api/geofencing/delete",e)},p.getGeofenceList=function(e){return Object(l.a)((d=Object(o.a)(p),Object(s.a)(n.prototype)),"get",d).call(d,"/api/geofencing",{params:e})},p.getGeofenceDetail=function(e){return Object(l.a)((b=Object(o.a)(p),Object(s.a)(n.prototype)),"get",b).call(b,"/api/geofencing/"+e)},p.getDevicesOfGeofence=function(e,t){return Object(l.a)((j=Object(o.a)(p),Object(s.a)(n.prototype)),"get",j).call(j,"/api/geofencing/".concat(e,"/devices"),{params:t})},p.getDeviceLocationsOfGeofence=function(e,t){return Object(l.a)((f=Object(o.a)(p),Object(s.a)(n.prototype)),"get",f).call(f,"/api/geofencing/".concat(e,"/deviceLocations"),{params:t})},p.getDeviceGeofenceDetail=function(e){return Object(l.a)((O=Object(o.a)(p),Object(s.a)(n.prototype)),"get",O).call(O,"/api/geofencing/device/".concat(e))},p}return Object(c.a)(n)}(n(107).a),d=new u;t.a=d},984:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Q}));var c,a=n(3),o=n(5),i=n(6),r=n(249),l=n(42),s=n(980),u=n(1e3),d=n(972),b=n(134),j=n(83),f=n(0),O=n(171),p=n(43),m=n(26),x=n(738),h=n(265),v=n(29),g=function(e){return{type:v.c.SET_ADDITIONAL_INFO,data:e}},C=function(e){return e.geofence.createParams},E=n(24),S=n(179),I=n(728),w=n(303),T=n(23),k=n(975),y=n(217),N=n(154),_=n(718),D=n(153),L=n(735),G=n(93),R=n(193),A=n.n(R),M=n(105),P=n(36),F=n(259),V=n.n(F),B=n(47),z=n(174),q=n(51),W=n(1),Y=Object(y.a)((function(e){return{formContainer:{height:"100%",position:"absolute",backgroundColor:"#ffffffcc",width:320,top:0,right:0,zIndex:400}}})),U=new Map([[E.d.METERS,"geofence.METERS"],[E.d.MILES,"geofence.MILES"],[E.d.KILOMETERS,"geofence.KILOMETERS"]]),K=[new P.e(E.d.METERS,U.get(E.d.METERS)),new P.e(E.d.MILES,U.get(E.d.MILES)),new P.e(E.d.KILOMETERS,U.get(E.d.KILOMETERS))],H="create-geofence-map";function Z(e){var t=Object(O.a)().t,n=Y(),c=Object(_.a)({id:H}),a=c.map,s=c.getMapInforTextFromLatlng,u=c.getInforStyle,d=c.clustMarker,m=Object(f.useState)(""),C=Object(i.a)(m,2),S=C[0],I=C[1],y=Object(f.useState)(),R=Object(i.a)(y,2),P=R[0],F=R[1],Z=Object(f.useState)(),J=Object(i.a)(Z,2),Q=J[0],X=J[1],$=Object(f.useState)([]),ee=Object(i.a)($,2),te=ee[0],ne=ee[1],ce=Object(f.useState)(null),ae=Object(i.a)(ce,2),oe=ae[0],ie=ae[1],re=Object(f.useState)(),le=Object(i.a)(re,2),se=le[0],ue=le[1],de=Object(f.useState)(E.d.METERS),be=Object(i.a)(de,2),je=be[0],fe=be[1],Oe=Object(f.useState)(),pe=Object(i.a)(Oe,2),me=pe[0],xe=pe[1],he=Object(f.useState)(!1),ve=Object(i.a)(he,2),ge=ve[0],Ce=ve[1],Ee=Object(f.useRef)(),Se=Object(p.c)(B.l),Ie=Object(p.b)(),we=Object(f.useMemo)((function(){var t=e.createValues,n=t.latitude,c=t.longitude;return Object(E.q)(n)||Object(E.q)(c)?null:[n,c]}),[e.createValues]),Te=Object(f.useCallback)((function(e){Ce(!0),x.a.searchReverse(e).then((function(t){var n=t;t.error&&(n={display_name:"unknown place",lat:e[0].toString(),lon:e[1].toString()}),Ce(!1),ie(n),ne([n])})).catch((function(){var t={display_name:"unknown place",lat:e[0].toString(),lon:e[1].toString()};Ce(!0),ie(t),ne([t])})),ue(e)}),[]),ke=Object(f.useMemo)((function(){return{radius:e.createValues.radius,name:e.createValues.name,description:e.createValues.description}}),[e.createValues]);Object(f.useEffect)((function(){we&&(Te(we),a&&a.setZoom(11))}),[ke,we,Te,a]);var ye=Object(N.a)({initialValues:ke,validationSchema:G.b({radius:G.a().required(t("geofence.requiredFields.radius")),name:G.c().required(t("geofence.requiredFields.name"))}),onSubmit:function(t){return console.log(t),new Promise((function(n,c){if(!se)return E.c.error("geofence.requiredFields.center"),void c();console.log(t,se);var a,o=t.name,i=t.radius,r=t.description;Ie((a=Object(w.a)(h.b,[o,i].concat(Object(T.a)(se),[r])),{type:v.c.SET_PLACE_INFO,data:a})),Ie(g({placeName:null===oe||void 0===oe?void 0:oe.display_name})),e.handleNext(),n()}))}}),Ne=Object(f.useCallback)((function(e,t){if(a&&!me){var n=V.a.circle(e,{fillColor:Se,radius:t,color:Se});n.addTo(a),xe(n)}}),[a,me,Se]);Object(f.useEffect)((function(){se&&(me?(me.setRadius(ye.values.radius),me.setLatLng(se),a.setView(se)):Ne(se,ye.values.radius))}),[d,se,Ne,me,ye.values.radius,a]);var _e=Object(f.useCallback)((function(){a&&navigator.geolocation.getCurrentPosition((function(e){var t=e.coords,n=[t.latitude,t.longitude];null===a||void 0===a||a.setView(n,11),ue(n),Te(n)}),(function(e){console.log(e),e.message?E.c.error(t("geofence.getUserPositionFailed",{message:e.message})):E.c.error(t("geofence.getUserPositionFailedNoMessgae"))}))}),[a,t,Te]);Object(f.useEffect)((function(){we||_e()}),[_e,we]),Object(f.useEffect)((function(){a&&(a.on("click",(function(e){var t=e.latlng,n=t.lat,c=t.lng;Te([n,c])})),a.on("mousemove",(function(e){var t=e.latlng,n=t.lat,c=t.lng;X([n,c]),F(e.containerPoint)})),a.on("mouseout",(function(){F(null)})))}),[a,Te]);var De=s(Q),Le=u(P),Ge=Object(f.useMemo)((function(){return A()((function(e){var t=e.target.value;I(t),Ce(!0),x.a.search(t).then((function(e){Ce(!1),ne(e)}))}),300)}),[]),Re=function(e){return Object(o.a)(Object(o.a)({},ye.getFieldProps(e)),{},{error:Boolean(ye.touched[e]&&ye.errors[e]),helperText:ye.touched[e]&&ye.errors[e]})},Ae=function(e){fe(e)};return Object(W.jsx)(l.a,{sx:{height:"calc(100% - 68px)",mt:5},children:Object(W.jsxs)(l.a,{className:"leaflet-map-container",sx:{height:600,position:"relative"},children:[Object(W.jsx)(l.a,{sx:{height:1,cursor:"default"},id:H}),Object(W.jsx)(l.a,{style:Le,ref:Ee,className:"map-location-infor",children:De}),Object(W.jsxs)(l.a,{className:n.formContainer+" border-box",sx:{p:3},children:[Object(W.jsx)(j.a,{variant:"subtitle1",sx:{mb:.5},children:t("geofence.locationLabel")}),Object(W.jsxs)(l.a,{sx:{position:"relative"},children:[Object(W.jsx)(q.a,{onClick:function(e){e.stopPropagation(),_e()},icon:"ic_site",primary:!0,style:{position:"absolute",right:6,top:4,zIndex:10,cursor:"pointer"},mr:0}),Object(W.jsx)(k.a,{options:te,popupIcon:Object(W.jsx)(l.a,{sx:{width:20}}),onChange:function(e,t){if(t){var n=t.lat,c=t.lon;ue([parseFloat(n),parseFloat(c)]),ie(t)}},value:oe,fullWidth:!0,noOptionsText:ge?Object(W.jsx)(r.a,{loading:ge}):Object(W.jsx)(z.a,{pt:0}),getOptionLabel:function(e){return e.display_name},renderInput:function(e){return Object(W.jsx)(D.a,Object(o.a)(Object(o.a)({onChange:Ge,value:S},e),{},{variant:"outlined"}))}})]}),Object(W.jsx)(j.a,{variant:"subtitle1",sx:{mb:1,mt:3},children:t("geofence.setRadius")}),Object(W.jsx)(l.a,{sx:{bgcolor:"#fff",height:48,p:1.5,borderRadius:2,boxShadow:E.g},className:"flex border-box",children:Object(W.jsx)(L.a,{inputProps:Object(o.a)({},ye.getFieldProps("radius")),customLabel:function(){var e=ye.values.radius,n=Object(E.v)(e,je),c=Object(W.jsx)(l.a,{sx:{width:1,height:1,px:1},className:"pointer",children:n+" "+t(U.get(je))});return Object(W.jsx)(M.a,{menus:K,selected:je,trigger:c,sx:{pl:0},onMenuClick:Ae})}(),max:1e4,min:100,valueLabelDisplay:"off"})}),Object(W.jsxs)(l.a,{sx:{height:64},children:[Object(W.jsx)(j.a,{variant:"subtitle1",sx:{mb:0,mt:3},children:t("common.name")}),Object(W.jsx)(D.a,Object(o.a)({},Re("name")))]}),Object(W.jsxs)(j.a,{variant:"subtitle1",sx:{mb:1,mt:3},children:[t("common.description"),Object(W.jsx)(D.a,Object(o.a)(Object(o.a)({},Re("description")),{},{maxRows:5,minRows:2,multiline:!0}))]}),Object(W.jsxs)(l.a,{className:"flex-end",sx:{mt:3},children:[Object(W.jsx)(b.a,{onClick:function(){e.handleCancel()},variant:"contained",children:t("common.cancel")}),Object(W.jsx)(r.a,{loading:ye.isSubmitting,onClick:function(){ye.handleSubmit(),ye.validateForm().then((function(e){console.log(e),Object(E.r)(e)||E.c.error("common.fillRequiredFields")}))},variant:"contained",sx:{ml:2},children:Object(W.jsx)("span",{children:t("common.nextStep")})})]})]})]})})}!function(e){e[e.CREATE_GEOFENCE=0]="CREATE_GEOFENCE",e[e.BIND_DEVICES=1]="BIND_DEVICES",e[e.SELECT_ACTIONS=2]="SELECT_ACTIONS"}(c||(c={}));var J=[{key:c.CREATE_GEOFENCE,label:"geofence.createStep.CREATE_GEOFENCE"},{key:c.BIND_DEVICES,label:"geofence.createStep.BIND_DEVICES"},{key:c.SELECT_ACTIONS,label:"geofence.createStep.SELECT_ACTIONS"}];function Q(){var e=Object(O.a)().t,t=Object(f.useState)(c.CREATE_GEOFENCE),n=Object(i.a)(t,2),w=n[0],T=n[1],k=Object(p.c)(C),y=Object(p.b)(),N=Object(f.useState)([]),_=Object(i.a)(N,2),D=_[0],L=_[1],G=Object(m.m)(),R=Object(f.useState)(!1),A=Object(i.a)(R,2),M=A[0],P=A[1],F=Object(f.useRef)(),V=Object(f.useState)(k.operation),B=Object(i.a)(V,2),z=B[0],q=B[1],Y=function(){T(w+1)};Object(f.useEffect)((function(){return function(){y(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h.a;return{type:v.c.INIT_CREATE_PARAMS,data:e}}())}}),[y]);var U=function(e){var t,n=F.current.getSelected(),c=F.current.getDevicesAndGroupIds(),a=c.deviceIdList,o=c.deviceGroupIdList;y((t={deviceGroupIdList:o,deviceIdList:a},{type:v.c.SET_DEVICES_INFO,data:t})),y(g({selectedDeviceAndGroups:D})),L(n),(null===n||void 0===n?void 0:n.length)>0?T("next"===e?w+1:w-1):E.c.error("geofence.requiredFields.devices")},K=function(e,t){var n,c=e.target.checked,i=Object(o.a)(Object(o.a)({},z),{},Object(a.a)({},t,c));q(i),y((n=i,{type:v.c.SET_ACTIONS_INFO,data:n}))},H=function(){T(w-1)},Q=function(){P(!0),x.a.createGeofence(Object(h.c)(k)).then((function(e){null!==e&&void 0!==e&&e.success&&(E.c.success("geofence.createSuccessed"),G("/geofence")),P(!1)})).catch((function(e){var t,n=(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"geofence.createFailed";E.c.error(n),P(!1)}))},X=function(){Object(E.a)({title:"geofence.backTitle",content:"geofence.backContent",onOk:function(){G("/geofence")}})};return Object(W.jsx)(l.a,{sx:{py:3},className:"flex",children:Object(W.jsxs)(l.a,{className:"geofence-detail-container  border-box",sx:{borderRadius:2,bgcolor:"#fff",height:1,width:{xs:1,sm:.8,lg:.75},p:3,overflowY:"auto"},children:[Object(W.jsx)(l.a,{className:"flex",children:Object(W.jsx)(s.a,{activeStep:w,sx:{width:{xs:1,md:.8,lg:.7}},children:J.map((function(t,n){return Object(W.jsx)(u.a,{children:Object(W.jsx)(d.a,{children:e(t.label)})},t.key)}))})}),Object(W.jsx)(l.a,{sx:{height:"calc(100% - 64px)",mt:5,overflow:"auto"},children:function(){switch(w){case c.CREATE_GEOFENCE:return Object(W.jsx)(Z,{handleCancel:X,createValues:k,handleNext:Y});case c.BIND_DEVICES:return Object(W.jsxs)(l.a,{children:[Object(W.jsx)(I.b,{selected:D,ref:F}),Object(W.jsxs)(l.a,{sx:{pt:3},className:"flex-end",children:[Object(W.jsx)(b.a,{onClick:X,children:e("common.cancel")}),Object(W.jsx)(b.a,{sx:{mx:2},variant:"outlined",onClick:function(){return U("prev")},children:e("common.prevStep")}),Object(W.jsx)(b.a,{variant:"contained",onClick:function(){return U("next")},children:e("common.nextStep")})]})]});case c.SELECT_ACTIONS:return Object(W.jsxs)(l.a,{className:"flex flex-column",children:[Object(W.jsxs)(l.a,{sx:{boxShadow:E.g,width:.8,m:1,p:4,borderRadius:1},className:"border-box",children:[Object(W.jsx)(j.a,{sx:{mb:3},children:e("geofence.actionTitle")}),Object(W.jsx)(S.a,{onChange:function(e){return K(e,"lockDevice")},label:"geofence.lockDevice",value:z.lockDevice}),Object(W.jsx)(S.a,{onChange:function(e){return K(e,"alarm")},label:"geofence.alarm",value:z.alarm})]}),Object(W.jsxs)(l.a,{sx:{pt:3,width:.8},className:"flex-end",children:[Object(W.jsx)(b.a,{onClick:X,children:e("common.cancel")}),Object(W.jsx)(b.a,{sx:{mx:2},variant:"outlined",onClick:H,children:e("common.prevStep")}),Object(W.jsx)(r.a,{loading:M,variant:"contained",onClick:Q,children:Object(W.jsx)("span",{children:e("common.confirm")})})]})]});default:return Object(W.jsx)(b.a,{onClick:function(){return T(w-1)}})}}()})]})})}}}]);
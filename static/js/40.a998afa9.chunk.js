(this["webpackJsonpui-ngx"]=this["webpackJsonpui-ngx"]||[]).push([[40],{832:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var i=n(5),c=n(154),a=n(135),l=n(93),o=n(153),s=n(42),r=n(0),u=n(24),d=n(1);function j(e){var t=e.dialogProps,n=e.detail,j=Object(c.a)({initialValues:{name:"",description:""},validateOnMount:!0,validationSchema:l.b({name:l.c().required("common.fillRequiredFields").max(60)}),onSubmit:function(e){return Promise.resolve()}});Object(r.useEffect)((function(){if(n&&t.open){var e=n.name,i=n.description;j.setValues({name:e,description:i})}}),[n,t.open]);var b=Object(r.useCallback)((function(e){return Object(i.a)(Object(i.a)({},j.getFieldProps(e)),{},{label:"common."+e,error:Boolean(j.errors[e]&&j.touched[e])})}),[j]);return Object(d.jsx)(a.b,Object(i.a)(Object(i.a)({fullWidth:!0},t),{},{onOk:function(){if(j.handleSubmit(),j.isValid)return t.onOk?t.onOk(j.values):void 0;u.c.error("common.fillRequiredFields")},onClose:function(){j.resetForm(),t&&t.onClose()},title:"pipe.editPipeProp",children:Object(d.jsxs)(s.a,{sx:{px:1.5,width:400,maxWidth:"calc(100% - 24px)"},children:[Object(d.jsx)(o.a,Object(i.a)(Object(i.a)({width:400},b("name")),{},{inputProps:{maxLength:60}})),Object(d.jsx)(o.a,Object(i.a)(Object(i.a)({sx:{mt:3},width:400},b("description")),{},{inputProps:{maxLength:80},maxRows:5,minRows:2,multiline:!0}))]})}))}},955:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return T}));var i,c=n(5),a=n(6),l=n(249),o=n(42),s=n(711),r=n(83),u=n(134),d=n(354),j=n(550),b=n(0),O=n(171),p=n(26),m=n(729),x=n(104),f=n(36),v=n(721),h=n(138),g=n(34),C=n(24),w=n(105),k=n(45),N=n(258),P=n(671),R=n(679),S=n(176),y=n(51),E=n(832),L=n(886),B=n(1);function T(){var e=Object(O.a)().t,t=Object(p.o)().id,n=Object(p.m)(),T=Object(b.useState)(),A=Object(a.a)(T,2),F=A[0],I=A[1],M=Object(b.useState)(!0),z=Object(a.a)(M,2),q=z[0],V=z[1],W=Object(b.useState)(!1),_=Object(a.a)(W,2),D=_[0],J=_[1],Y=Object(b.useState)(),H=Object(a.a)(Y,2),U=H[0],G=H[1],K=Object(b.useState)(new h.d(0,10,void 0,P.a.BY_CREATED_TIME,"desc",{pipelineId:t})),Q=Object(a.a)(K,2),X=Q[0],Z=Q[1],$=Object(b.useState)(),ee=Object(a.a)($,2),te=ee[0],ne=ee[1],ie=Object(b.useState)(!1),ce=Object(a.a)(ie,2),ae=ce[0],le=ce[1],oe=Object(b.useState)(!1),se=Object(a.a)(oe,2),re=se[0],ue=se[1],de=Object(x.b)(),je=(null===U||void 0===U?void 0:U.pipelineStageRunLogList)||[],be=je.length>0,Oe=Object(b.useCallback)((function(){var e=m.a.getRunningRunByPipelineId(t);return e.then((function(e){G(e)})).catch((function(e){Object(C.p)(e)})),e}),[t]),pe=Object(b.useCallback)((function(){var e=m.a.getPipelineDetail(t);return e.then((function(e){I(e)})).catch((function(e){Object(C.p)(e)})),e}),[t]),me=Object(b.useCallback)((function(){le(!0),m.a.getRunsByPipelineId(X).then((function(e){ne(e),le(!1)})).catch((function(){le(!1)}))}),[X]),xe=Object(b.useCallback)((function(){me(),Promise.all([Oe(),pe()]).finally((function(){V(!1)}))}),[me,Oe,pe]);Object(b.useEffect)((function(){xe()}),[xe]);var fe=Object(b.useCallback)((function(){n("/pipelines/edit/"+t)}),[t,n]),ve=Object(b.useCallback)((function(e,t){t&&ue(!0),m.a.cancelPipeRun({pipelineRunLogId:e}).then((function(){t&&ue(!1),xe()})).catch((function(e){var n;t&&ue(!1),(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)&&C.c.error(e.data.message)}))}),[xe]),he=Object(b.useCallback)((function(e,t){if(e===i.CANCEL)ve(t.id)}),[ve]),ge=Object(b.useCallback)((function(e){n("/pipelines/view/".concat(t,"/runs/").concat(e))}),[n,t]),Ce=Object(b.useMemo)((function(){var t=[new k.f("left","runNo","pipe.runNo",null,(function(e){return Object(B.jsx)(S.a,{showUnderline:!1,onClick:function(){return ge(e.id)},children:e.runNo})})),new k.d("status","common.status",void 0,null,(function(t){var n=v.c.get(t.status);return Object(B.jsx)(o.a,{sx:{pl:1},children:Object(B.jsx)(R.a,{size:"small",innerStyle:{fontSize:12},sx:{ml:1},color:n.color,label:e(n.label)})})})),new k.d("user","pipe.initiatedBy",void 0,void 0,(function(e){var t,n,i,c;return Object(B.jsxs)(o.a,{sx:{pl:2},className:"flex-start flex-nowrap",children:[Object(B.jsx)(s.a,{sx:{width:32,height:32},src:g.n.get(null===(t=e.user)||void 0===t?void 0:t.avatar),children:null===(n=e.user)||void 0===n?void 0:n.firstName}),Object(B.jsx)(r.a,{sx:{ml:1},children:(null===(i=e.user)||void 0===i?void 0:i.firstName)+" "+(null===(c=e.user)||void 0===c?void 0:c.lastName)})]})})),new k.b("createdTime","pipe.startRunTime",null),new k.b("endTime","pipe.endRunTime",null)];return de||t.push(new k.d("operation","common.operation","right",80,(function(e){var t=!v.g.includes(e.status);return Object(B.jsx)(o.a,{children:Object(B.jsx)(w.a,{menus:[new f.e(i.CANCEL,"common.cancel",void 0,!1,t)],onMenuClick:function(t){return he(t,e)}})})}))),t}),[he,ge,e,de]),we=Object(b.useCallback)((function(e){var n=m.a.savePipeline(Object(c.a)(Object(c.a)({},e),{},{id:t}));return n.then((function(){Oe()})).catch((function(e){var t;(null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)&&C.c.error(e.data.message)})),n}),[t,Oe]),ke=Object(b.useMemo)((function(){return v.c.get(null===U||void 0===U?void 0:U.status)}),[null===U||void 0===U?void 0:U.status]);return Object(B.jsxs)(o.a,{className:"relative-position",sx:{height:1},children:[Object(B.jsx)(N.a,{loading:q}),Object(B.jsxs)(o.a,{className:"border-box",sx:{px:3,mx:2,py:2,height:1,bgcolor:function(e){return e.custom.commonBg},overflowY:"auto"},children:[Object(B.jsxs)(o.a,{className:"flex-between",sx:{},children:[Object(B.jsx)(r.a,{children:null===F||void 0===F?void 0:F.name}),Object(B.jsxs)(o.a,{children:[!de&&Object(B.jsx)(u.a,{onClick:function(){return J(!0)},sx:{mr:1},children:e("pipe.editProp")}),!de&&Object(B.jsx)(l.a,{disabled:be,sx:{mr:1},onClick:fe,variant:"contained",children:Object(B.jsx)("span",{children:e("pipe.configNewRun")})}),Object(B.jsx)(d.a,{onClick:xe,children:Object(B.jsx)(y.a,{primary:!0,icon:"ic_refresh",mr:0})})]})]}),Object(B.jsx)(j.a,{sx:{my:2}}),be&&Object(B.jsxs)(b.Fragment,{children:[Object(B.jsxs)(o.a,{sx:{mb:1},className:"flex-between",children:[Object(B.jsxs)(o.a,{className:"flex-start",children:[Object(B.jsx)(r.a,{sx:{mr:1,fontWeight:"bold"},children:null===U||void 0===U?void 0:U.runNo}),ke&&Object(B.jsx)(R.a,{size:"small",sx:{ml:1},color:ke.color,label:e(ke.label)})]}),Object(B.jsx)(l.a,{sx:{mr:1},loading:re,onClick:function(){return ve(null===U||void 0===U?void 0:U.id,!0)},color:"error",children:Object(B.jsx)("span",{children:e("pipe.cancelRun")})})]}),Object(B.jsx)(L.a,{selectable:!1,stages:je})]}),Object(B.jsx)(o.a,{className:"flex-between",children:Object(B.jsx)(r.a,{variant:"h3",children:e("pipe.runHistory")})}),Object(B.jsx)(j.a,{sx:{my:2}}),Object(B.jsxs)(o.a,{className:"flex-start",children:[Object(B.jsx)(r.a,{sx:{mt:1,mr:3},children:e("pipe.allPipeRuns")}),Object(B.jsx)(r.a,{variant:"subtitle2",sx:{mt:1},children:te&&e("pipe.pipelineRunCounts",{count:null===te||void 0===te?void 0:te.totalElements})})]}),Object(B.jsx)(o.a,{children:Object(B.jsx)(k.g,{hideBoxShadow:!0,loading:ae,rows:null===te||void 0===te?void 0:te.content,columns:Ce,pageSize:10,page:X.page,totalPages:null===te||void 0===te?void 0:te.totalPages,pageChange:function(e){Z(Object(c.a)(Object(c.a)({},X),{},{page:e}))}})})]}),Object(B.jsx)(E.a,{dialogProps:{open:D,onClose:function(){return J(!1)},onOk:we},detail:{name:null===F||void 0===F?void 0:F.name,description:null===F||void 0===F?void 0:F.description}})]})}!function(e){e[e.CANCEL=0]="CANCEL"}(i||(i={}))}}]);